<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Acquisition ‚Ä¢ DealBankers</title>
<link rel="icon" type="image/jpeg" href="icon (1).jpg"/>
<style>
  :root{--panel:#0f1c28;--line:#1e3343;--text:#edf5fb;--muted:#9fb4c6;--cta:#1ecf7a}
  *{box-sizing:border-box}
  body{margin:0;background:#0b141d;color:var(--text);font-family:system-ui,Segoe UI,Arial,sans-serif}
  /* top toolbar */
  .bar{position:sticky;top:0;z-index:6;border-bottom:1px solid var(--line);
       background:linear-gradient(180deg,rgba(255,255,255,.06),transparent)}
  .bar-inner{display:flex;gap:10px;align-items:center;padding:10px}
  .icons{display:flex;gap:8px;flex-wrap:wrap}
  .ico{width:38px;height:38px;border-radius:10px;border:1px solid var(--line);
       background:#0e2332;display:grid;place-items:center;color:#e9f4ff;text-decoration:none}
  .ico:hover{background:#143142}
  .cta{flex:1 1 auto;text-align:center;padding:12px;border-radius:12px;
       background:linear-gradient(180deg,var(--cta),#189f62);color:#08140d;
       font-weight:900;border:0;cursor:pointer}
  /* layout */
  .shell{display:grid;grid-template-columns:1fr 340px;gap:12px;padding:12px}
  @media(max-width:900px){.shell{grid-template-columns:1fr}}
  /* lead card */
  .card{border:1px solid var(--line);border-radius:12px;background:#0d1f2c;overflow:hidden}
  .ttl{padding:12px 14px;border-bottom:1px solid var(--line);font-weight:900}
  .body{padding:10px 12px}
  .name{font-weight:900;font-size:18px;margin:2px 0 10px}
  details{background:#0c1b27;border:1px solid var(--line);border-radius:10px;margin:8px 0;overflow:hidden}
  summary{padding:10px 12px;cursor:pointer;font-weight:800}
  .map{width:100%;height:220px;border:0;border-radius:10px;background:#fff;margin-top:8px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{font-size:12px;font-weight:700;padding:6px 10px;border-radius:999px;
        background:#0e2332;border:1px solid var(--line);color:#cfe1f1}
  /* notes */
  .notes{border:1px solid var(--line);border-radius:12px;background:#0d1f2c;
         display:flex;flex-direction:column;min-height:420px;position:sticky;top:62px}
  .notes .hd{padding:10px 12px;border-bottom:1px solid var(--line);
             display:flex;justify-content:space-between;align-items:center}
  .notes .pad{padding:10px 12px;display:flex;flex-direction:column;gap:8px}
  textarea{width:100%;min-height:240px;border-radius:10px;border:1px solid #25465b;
           background:#0b1a24;color:#eaf6ff;padding:10px 12px;resize:vertical}
  .btnS{padding:8px 10px;border-radius:10px;border:1px solid var(--line);
        background:#0e2332;color:#eaf6ff;cursor:pointer}
  @media(max-width:480px){.map{height:190px}}
</style>
</head>
<body>
  <!-- Minimal toolbar -->
  <div class="bar"><div class="bar-inner">
    <div class="icons">
      <a id="prev" class="ico" title="Prev">‚óÄÔ∏è</a>
      <a id="rand" class="ico" title="Random">üé≤</a>
    </div>
    <button id="next" class="cta">Next Deal</button>
    <div class="icons">
      <a id="call"  class="ico" title="Call">üìû</a>
      <a id="sms"   class="ico" title="SMS">üí¨</a>
      <a id="email" class="ico" title="Email">‚úâÔ∏è</a>
      <a id="copy"  class="ico" title="Copy Phone">üìã</a>
    </div>
  </div></div>

  <div class="shell">
    <div>
      <div id="leadCard" class="card"><div class="body">Loading‚Ä¶</div></div>
    </div>

    <aside class="notes">
      <div class="hd"><strong>Notes</strong><span id="saveState" style="font-size:12px;color:#9fb4c6">Idle</span></div>
      <div class="pad">
        <textarea id="notesText" placeholder="Call outcomes, asks, timeline, objections, offer terms‚Ä¶"></textarea>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btnS" id="openForm">Open Form</button>
          <button class="btnS" id="insertStamp">Insert Timestamp</button>
          <button class="btnS" id="clearNotes">Clear</button>
          <button class="btnS" id="saveLocal">Save (Local)</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- cache-busted leads.js -->
  <script>
    (function(){
      const s=document.createElement('script');
      s.src='/leads.js?v='+Date.now();
      s.onload=()=>{ window.leads=window.leads||[]; init(); };
      s.onerror=()=>{ document.getElementById('leadCard').innerHTML='<div class="body">Could not load leads.js</div>'; };
      document.head.appendChild(s);
    })();
  </script>

  <script>
    const $=q=>document.querySelector(q);
    let i=0;
    const uid=new URL(location.href).searchParams.get('uid')||'anon';
    const phoneOf=l=>(l?.contacts?.[0]?.phone||'').trim();
    const nameOf =l=>(l?.contacts?.[0]?.name || 'Unknown').trim();
    const addrOf =l=>(l?.address||'').trim();

    function postCount(text){ window.parent?.postMessage({type:'count',scope:'acq',text},'*'); }

    function render(n){
      if(!Array.isArray(window.leads)||!window.leads.length){
        $('#leadCard').innerHTML='<div class="body">No leads loaded.</div>';
        postCount('No leads'); return;
      }
      if(n<0) n=window.leads.length-1;
      if(n>=window.leads.length) n=0;
      i=n;

      const L=window.leads[i];
      const name=nameOf(L);
      const phone=phoneOf(L);
      const addr=addrOf(L);
      const notes=(L?.notes||'').replace(/\n/g,'<br>');

      postCount(`Lead ${i+1} of ${window.leads.length}`);

      // toolbar links
      $('#call').href  = phone?`tel:${phone}`:'#';
      $('#sms').href   = phone?`sms:${phone}`:'#';
      $('#email').href = `mailto:?subject=${encodeURIComponent(name)} ‚Äî Lead`;
      $('#copy').onclick = ()=>{ if(!phone) return alert('No phone'); navigator.clipboard.writeText(phone).then(()=>alert('Copied: '+phone)); };

      // lead card
      $('#leadCard').innerHTML = `
        <div class="ttl">${addr || name}</div>
        <div class="body">
          <div class="name">${name}</div>
          <details open>
            <summary>üìä Deal Details</summary>
            <div style="padding:8px 12px">${notes || 'No deal notes available.'}</div>
          </details>

          ${addr?`<iframe class="map" src="https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed" loading="lazy"></iframe>`:''}

          <div class="chips">
            <div class="chip">UID: ${uid.slice(0,8)}</div>
            <div class="chip">${phone ? 'Phone on file' : 'Phone missing'}</div>
            ${addr?`<a class="chip" href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(addr)}" target="_blank" rel="noopener">Directions</a>`:''}
            ${addr?`<a class="chip" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(addr)}" target="_blank" rel="noopener">Open in Google Maps</a>`:''}
          </div>
        </div>`;
      
      // notes (local)
      const key='acqNotes:'+btoa(unescape(encodeURIComponent((addr||name)+'|'+uid))).replace(/=+$/,'');
      const ta=$('#notesText'); const ss=$('#saveState');
      ta.value=localStorage.getItem(key)||''; ss.textContent='Idle';
      $('#saveLocal').onclick = ()=>{ localStorage.setItem(key, ta.value||''); ss.textContent='Saved ‚Ä¢ '+new Date().toLocaleTimeString(); };
      $('#insertStamp').onclick= ()=>{ ta.value += `\n[${new Date().toLocaleString()}] `; };
      $('#clearNotes').onclick = ()=>{ if(confirm('Clear notes for this lead?')) ta.value=''; };
      $('#openForm').onclick   = ()=> {
        const url=`https://docs.google.com/forms/d/e/1FAIpQLScIZ7GX_ga5yOx34817gOL8Bb5m3KFXW8r-5I4taw_-ergOxw/viewform?usp=pp_url&entry.849181096=${encodeURIComponent('Wholesaler')}&entry.121126280=${encodeURIComponent(name)}&entry.1828741519=${encodeURIComponent(addr)}`;
        window.open(url,'_blank','noopener');
      };
    }

    // controls
    $('#next').onclick = ()=>render(i+1);
    $('#prev').onclick = ()=>render(i-1);
    $('#rand').onclick = ()=>render(Math.floor(Math.random()*(window.leads?.length||1)));

    // parent ‚Üí child controls
    window.addEventListener('message',ev=>{
      const c=ev.data?.cmd;
      if(c==='next') return $('#next').click();
      if(c==='prev') return $('#prev').click();
      if(c==='rand') return $('#rand').click();
      if(c==='call') return $('#call').click();
      if(c==='sms')  return $('#sms').click();
      if(c==='email')return $('#email').click();
      if(c==='copy') return $('#copy').click();
    });

    // init after leads load
    function init(){
      if(document.readyState==='loading'){
        document.addEventListener('DOMContentLoaded',()=>render(0));
      } else { render(0); }
    }
  </script>
</body>
</html>
