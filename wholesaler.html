"<!DOCTYPE html>
<html lang=""en"">
<head>
<meta charset=""utf-8"" />
<meta name=""viewport"" content=""width=device-width,initial-scale=1"" />
<title>DealBankers ‚Ä¢ Wholesaler</title>
<link rel=""icon"" type=""image/jpeg"" href=""icon (1).jpg"" />
<link rel=""preconnect"" href=""https://fonts.googleapis.com"" />
<link rel=""preconnect"" href=""https://fonts.gstatic.com"" crossorigin />
<link href=""https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"" rel=""stylesheet"" />

<style>
:root {
  --bg1:#0b131b;--bg2:#142838;--bg3:#173c53;--line:#254a63;
  --text:#f1f7fb;--muted:#c5d3e1;--accent:#2b74ff;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  margin:0;font-family:Inter,system-ui,Arial;
  color:var(--text);
  background:linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));
  min-height:100vh;
}

/* HEADER / NAV */
.header{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 16px;
  border-bottom:1px solid rgba(255,255,255,.2);
  background:linear-gradient(180deg,rgba(255,255,255,.1),rgba(255,255,255,.04));
}
.nav{display:flex;gap:8px;flex-wrap:wrap}
.chip{
  padding:6px 14px;border-radius:100px;
  border:1px solid rgba(255,255,255,.22);
  background:#0d1823;color:var(--text);
  text-decoration:none;cursor:pointer;font-weight:600;
  transition:background .2s,transform .2s;
}
.chip:hover{background:#14314d;transform:scale(1.03)}
.chip.primary{background:#133e6a}
.chip.danger{background:#6b1111}

/* Settings Gear */
.icon-btn {
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 50%;
  width: 34px;
  height: 34px;
  font-size: 18px;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
.icon-btn:hover {
  background: rgba(255,255,255,0.25);
}

.wrap{max-width:1200px;margin:0 auto;padding:16px}
.card{
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.15);
  border-radius:20px;
  box-shadow:0 28px 70px rgba(0,0,0,.55);
  overflow:hidden;
}
.top{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.2);
}
.seg{display:flex;border:1px solid rgba(255,255,255,.22);border-radius:999px}
.seg button{
  padding:8px 14px;border:0;background:#0e2332;
  color:#cfe6ff;cursor:pointer
}
.seg button.active{
  background:linear-gradient(180deg,#2b74ff,#0a58ca);color:#fff
}
.status{font-size:12px;color:#9ab9d6}

/* BODY GRID */
.body{
  padding:14px;
  display:grid;
  grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
  gap:16px;
}
@media (max-width:960px){
  .body{grid-template-columns:1fr}
}

/* LEFT (Lead List) */
.search{
  display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap
}
.input{
  flex:1;background:#0d1f2d;border:1px solid #254a63;
  color:#fff;border-radius:12px;padding:8px 10px;
}
.small{padding:4px 10px;font-size:12px}

.table-wrap{overflow-x:auto;border-radius:12px}
table{width:100%;border-collapse:collapse;font-size:14px;min-width:600px}
th,td{padding:10px;border-top:1px solid rgba(255,255,255,.2)}
thead th{border-top:0;color:#cfe3ff}
tr.lead-row{cursor:pointer}
tr.lead-row:hover{background:rgba(255,255,255,.06)}
tr.lead-row.selected{background:rgba(43,116,255,.25)}

/* RIGHT PANEL */
.right-col{
  background:#0b1825;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  padding:12px;
}
.detail-header{margin-bottom:6px}
.detail-header h3{margin:0;font-size:16px}
.detail-header .sub{font-size:12px;color:#9ab9d6}

.detail-info{font-size:13px;margin-bottom:10px}
.script-box{
  background:#0d2233;border-radius:10px;padding:10px;
  font-size:13px;line-height:1.5;margin-top:8px;
}
.detail-actions{display:flex;gap:8px;margin-top:8px}

/* MAP */
.map-wrap{margin-top:12px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.2)}
.map-wrap iframe{width:100%;height:250px;border:0}

/* Onboarding Modal Backdrop */
.modal-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center;z-index:9999;
}
.modal{
  background:#0f1b27;border:1px solid #254a63;
  border-radius:16px;padding:16px;max-width:520px;
  width:92%;box-shadow:0 28px 70px rgba(0,0,0,.55);
}
.modal.wide{max-width:650px}
.empty-actions button{
  margin:10px;
  padding:10px 16px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}
.empty-actions button:hover{
  background:#1a4fd8;
}
</style>

<!-- Firebase -->
<script src=""https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js""></script>
<script src=""https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js""></script>
<script src=""https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js""></script>
<script src=""config.js""></script>
<script src=""app-auth.js""></script>
</head>

<body data-portal=""wholesaler"">

<header class=""header"">
  <div>DEALBANKERS ‚Ä¢ Wholesaler Portal</div>
  <nav class=""nav"">
   <a class=""chip"" href=""profile.html"">Dashboard</a>
    <button class=""chip"" id=""btnBlue"">üåÄ Blue</button>
    <button class=""chip danger"" id=""btnRed"">üö® Red</button>
    <button class=""icon-btn"" id=""btnSettings"">‚öôÔ∏è</button>
    <a class=""chip"" id=""logoutBtn"">Log Out</a>
  </nav>
</header>"
"<div class=""wrap"">
  <section class=""card"">
    <div class=""top"">
      <div>
        <div id=""crumb"">Acquisition</div>
        <div class=""status"" id=""status"">Loading‚Ä¶</div>
      </div>
      <div class=""seg"">
        <button id=""tabAcq"" class=""active"">Acq</button>
        <button id=""tabDispo"">Dispo</button>
      </div>
    </div>
    
    <div class=""body"">
      <!-- LEFT SIDE -->
      <div id=""panel-acq"">
        <div class=""search"">
          <input id=""s_q"" class=""input"" placeholder=""Search address / owner"" />
          <button class=""chip small"" id=""s_reload"">Search</button>
        </div>
        <div class=""table-wrap"">
          <table>
            <thead><tr><th>Address</th><th>Owner</th><th>Phone</th><th>Status</th><th>Notes</th></tr></thead>
            <tbody id=""sellerRows""></tbody>
          </table>
        </div>
      </div>

      <!-- RIGHT SIDE -->
      <div class=""right-col"" id=""detailPanel"">
        <div class=""detail-header"">
          <h3 id=""detailTitle"">No lead selected</h3>
          <div class=""sub"" id=""detailSub"">Select a lead to load details and map.</div>
        </div>

        <div class=""detail-info"" id=""detailInfo"" style=""display:none;"">
          <div><strong>Address:</strong> <span id=""detailAddr""></span></div>
          <div><strong>Owner:</strong> <span id=""detailOwner""></span></div>
          <div><strong>Phone:</strong> <span id=""detailPhone""></span></div>
        </div>

        <div class=""script-box"" id=""scriptBox"">Select a lead to load script.</div>

        <div class=""map-wrap"" id=""mapWrap"" style=""display:none;"">
          <iframe id=""streetFrame"" loading=""lazy""></iframe>
        </div>
      </div>
    </div>
  </section>
</div>"
"<!-- Main JS -->
<script>
let UID=null, IS_ADMIN=false, VIEW_AS=null;
let sRef=null;
let sellerList=[]; let sellerView=[]; let currentIndex=-1;

document.getElementById('btnSettings').onclick = () => {
  location.href = 'settings.html';
};

const esc = s => (''+(s||'')).replace(/[&<>""']/g,m=>(
  {'&':'&amp;','<':'&lt;','>':'&gt;','""':'&quot;',""'"":'&#39;'}[m])
);

firebase.auth().onAuthStateChanged(async (u)=>{
  if(!u){ location.href='index.html'; return; }
  UID=u.uid;
  subscribe();

  // üî• Trigger onboarding check immediately at login
  setTimeout(() => { maybeShowOnboardingForPortal(); }, 800);
});


function subscribe(){
  if(sRef) sRef.off();
  sRef=firebase.database().ref('leads/sellers');
  sRef.on('value',snap=>{
    const obj=snap.val()||{};
    sellerList=Object.entries(obj).map(([id,v])=>({id,...v}));
    renderS();
  });
}

function renderS(){
  const q=(document.getElementById('s_q').value||'').toLowerCase();
  sellerView=sellerList.filter(v=>
    !q || (v.address||'').toLowerCase().includes(q) || (v.owner||'').toLowerCase().includes(q)
  );
  
  const tbody=document.getElementById('sellerRows');
  document.getElementById('status').textContent='Acq: '+sellerView.length+' items';

  if(!sellerView.length){
    tbody.innerHTML='<tr><td colspan=""5"" class=""status"">No leads yet.</td></tr>';
    updateDetail(null);
    maybeShowOnboardingForPortal();
    return;
  }

  tbody.innerHTML=sellerView.map((v,i)=>`
    <tr class=""lead-row"" data-idx=""${i}"">
      <td>${esc(v.address)}</td>
      <td>${esc(v.owner||'')}</td>
      <td>${esc(v.phone||'')}</td>
      <td>${esc(v.status||'new')}</td>
      <td>${esc(v.notes||'')}</td>
    </tr>`
  ).join('');

  tbody.querySelectorAll('tr.lead-row').forEach(r=>{
    r.addEventListener('click',()=>{
      currentIndex=parseInt(r.dataset.idx,10);
      updateDetail(sellerView[currentIndex]);
      highlightRow();
    });
  });
}

function highlightRow(){
  document.querySelectorAll('#sellerRows tr.lead-row').forEach(r=>r.classList.remove('selected'));
  if(currentIndex>=0){
    const row=document.querySelector(`#sellerRows tr.lead-row[data-idx=""${currentIndex}""]`);
    if(row) row.classList.add('selected');
  }
}

function updateDetail(lead){
  const frame=document.getElementById('streetFrame');
  const mapW=document.getElementById('mapWrap');
  
  if(!lead){
    document.getElementById('detailTitle').textContent='No lead selected';
    document.getElementById('detailSub').textContent='Select a lead to load details.';
    document.getElementById('detailInfo').style.display='none';
    mapW.style.display='none'; frame.src='';
    document.getElementById('scriptBox').textContent='Select a lead to load script.';
    return;
  }

  document.getElementById('detailInfo').style.display='block';
  document.getElementById('detailAddr').textContent=lead.address||'';
  document.getElementById('detailOwner').textContent=lead.owner||'';
  document.getElementById('detailPhone').textContent=lead.phone||'';

  if(lead.address){
    frame.src='https://www.google.com/maps?q='+encodeURIComponent(lead.address)+'&output=embed';
    mapW.style.display='block';
  } else {
    mapW.style.display='none';
    frame.src='';
  }

  document.getElementById('detailTitle').textContent=lead.owner||'Unknown Owner';
  document.getElementById('detailSub').textContent=lead.address||'';
  
  document.getElementById('scriptBox').innerHTML = `
    <p><strong>Opener:</strong> ""Hi ${lead.owner?.split(' ')[0]||'there'}, this is Bill with DealBankers ‚Äî sound familiar?""</p>
    <p><strong>Frame:</strong> ""I specialize in solving problem properties ‚Äî taxes, liens, inherited houses ‚Äî anything stressing you out.""</p>
  `;
}
</script>

<!-- Onboarding & Modal Logic -->
<script>
function closeModal(btn){
  btn.closest('.modal-backdrop').remove();
}

function dismissOnboarding(btn){
  const u = firebase.auth().currentUser;
  if (u) {
    firebase.database().ref(`userSettings/${u.uid}/onboardingDismissed`).set(true);
  }
  btn.closest('.modal-backdrop').remove();
}

async function maybeShowOnboardingForPortal() {
  const u = firebase.auth().currentUser;
  if (!u) return;

  const uid = u.uid;
  const portal = document.body.dataset.portal;

  const adminOnboarding = await firebase.database().ref(`admin/onboardingEnabled`).once('value');
  if (adminOnboarding.exists() && adminOnboarding.val() === false) return;

  const userDismissed = await firebase.database().ref(`userSettings/${uid}/onboardingDismissed`).once('value');
  if (userDismissed.exists() && userDismissed.val() === true) return;

  if (portal === 'wholesaler' && sellerView.length === 0) {
    showOnboarding(portal);
  }
}

const portalText = {
  contractor: {
    title: ""üöÄ Welcome Contractor!"",
    msg: ""To start receiving jobs, fill in your service areas, trade skills, and enable live location."",
    action1: ""üìç Service Areas"",
    action2: ""üõ† Trade Skills"",
    action3: ""üì° Enable Live Location"",
  },
  wholesaler: {
    title: ""üéØ Welcome Wholesaler!"",
    msg: ""Upload leads, skip trace, and start making calls to lock deals for assignment."",
    action1: ""üì§ Upload Leads"",
    action2: ""üîç Skip Trace"",
    action3: ""üìû Start Calling"",
  },
  investor: {
    title: ""üíº Welcome Investor!"",
    msg: ""Tell us what properties you're looking for, your budget, and markets of interest."",
    action1: ""üìå Set Buy Box"",
    action2: ""üìà Define Budget"",
    action3: ""üèò View Deals"",
  }
};
</script>
<script>
function showOnboarding(portal) {
  const pt = portalText[portal] || {
    title: ""üëã Welcome!"",
    msg: ""Let‚Äôs get you started."",
    action1: ""‚öôÔ∏è Settings"",
    action2: """",
    action3: """"
  };

  const m = document.createElement('div');
  m.className = 'modal-backdrop';
  m.innerHTML = `
    <div class=""modal wide"">
      <h2>${pt.title}</h2>
      <p>${pt.msg}</p>
      <div class=""empty-actions"">
        ${pt.action1 ? `<button onclick=""location.href='settings.html'"">${pt.action1}</button>` : ''}
        ${pt.action2 ? `<button>${pt.action2}</button>` : ''}
        ${pt.action3 ? `<button>${pt.action3}</button>` : ''}
      </div>
      <div class=""actions"">
        <button class=""chip"" onclick=""dismissOnboarding(this)"">Don't show again</button>
        <button class=""chip"" onclick=""closeModal(this)"">Close</button>
      </div>
    </div>
  `;
  document.body.appendChild(m);
  m.style.display = 'flex';
}
</script>

</body>
</html>"
