<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Acquisition ‚Ä¢ DealBankers</title>
  <link rel="icon" type="image/jpeg" href="icon (1).jpg"/>

  <style>
    :root{
      /* Brighter, like Dispo */
      --bg1:#0b1218; --bg2:#0e1a24; --bg3:#133247;
      --panel:#0d1f2e;               /* lighter than before */
      --card:#112a3d;                /* brighter card */
      --line:#224055;
      --text:#f2f7fb; --muted:#bcd0e3;
      --accent:#57e3ff; --accent2:#ffd36a;
      --green:#2fd07a; --bluebtn:#1a7fff;
      --shadow:0 24px 60px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;
      background:
        radial-gradient(1200px 480px at 92% -10%, #1c4561 0%, transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));
      padding:12px;
    }

    .wrap{max-width:1100px;margin:0 auto;filter:saturate(1.06)}
    .card{
      background:
        linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      border:1px solid var(--line); border-radius:22px; box-shadow:var(--shadow);
      overflow:hidden;
    }

    .top{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px; border-bottom:1px solid var(--line);
      background:
        radial-gradient(700px 220px at 4% 0%, rgba(255,255,255,.16), transparent 70%),
        linear-gradient(90deg, rgba(87,227,255,.18), rgba(255,211,106,.16));
    }
    .crumbs{display:flex; gap:10px; align-items:center; font-size:13px; color:#e6f4ff}
    .crumbs .dot{width:7px;height:7px;border-radius:999px;background:var(--accent);box-shadow:0 0 14px rgba(87,227,255,.9)}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;padding:12px;border-bottom:1px solid var(--line);background:#0e2536}
    .btn{
      padding:10px 14px; border-radius:12px; border:1px solid #21445b; cursor:pointer;
      background:#0f3247; color:#eef7ff; font-weight:700; letter-spacing:.02em;
      transition:filter .15s ease, transform .02s ease;
    }
    .btn:hover{filter:brightness(1.08)}
    .btn:active{transform:translateY(1px)}
    .btn-green{background:linear-gradient(180deg,var(--green),#1aa764); border:none; color:#081411}
    .btn-blue{background:linear-gradient(180deg,var(--bluebtn),#165fbe); border:none}

    .grid{display:grid; grid-template-columns:1fr 340px; gap:14px; padding:14px}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }

    .panel{
      background:var(--panel); border:1px solid var(--line); border-radius:var(--r); overflow:hidden;
    }
    .panel .hd{
      padding:12px 14px; font-weight:800; font-size:14px; letter-spacing:.02em;
      border-bottom:1px solid var(--line);
      background:
        linear-gradient(90deg, rgba(255,211,106,.22), transparent 40%),
        linear-gradient(180deg, rgba(0,0,0,.15), transparent);
    }
    .pad{padding:12px 14px}

    /* Sticky Quickbar right under the toolbar */
    .quickbar{
      position:sticky; top:0; z-index:5;
      display:flex; gap:8px; flex-wrap:wrap; padding:10px 12px;
      background:linear-gradient(180deg,#133247,#102a3e);
      border-bottom:1px solid var(--line);
    }
    .qbtn{
      flex:1 1 140px;
      display:flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 14px; border-radius:12px; border:1px solid #21445b;
      background:#124a6a; color:#eaf7ff; font-weight:800;
      box-shadow:0 10px 18px rgba(0,0,0,.25);
    }
    .qbtn:hover{filter:brightness(1.08)}
    .qbtn.call {background:linear-gradient(180deg,#2fe18a,#1bb76d); color:#092014}
    .qbtn.sms  {background:linear-gradient(180deg,#4eb6ff,#1a7fff)}
    .qbtn.mail {background:linear-gradient(180deg,#ffd36a,#c89a2a); color:#0c0c0c}
    .qbtn.note {background:linear-gradient(180deg,#ffffff,#dfe7ee); color:#0a2540}

    /* Lead card (brighter) */
    .lead{border:1px solid var(--line); border-radius:14px; overflow:hidden;
      background:linear-gradient(180deg,var(--card),#0e2739)}
    .lead .title{padding:14px; font-weight:900; letter-spacing:.02em;
      background:
        radial-gradient(600px 260px at 6% -20%, rgba(255,255,255,.25), transparent 70%),
        linear-gradient(90deg, rgba(255,211,106,.26), transparent 40%),
        linear-gradient(180deg, rgba(0,0,0,.25), transparent);
      border-bottom:1px solid var(--line);
    }
    .lead .body{padding:12px 14px}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0}
    .chip{font-size:12px; padding:7px 12px; border-radius:999px; border:1px solid #28506a; background:#123a53}

    details{background:#103145; border:1px solid #224b63; border-radius:10px; overflow:hidden; margin:8px 0}
    summary{cursor:pointer; padding:12px 12px; font-weight:700}
    .map{width:100%; height:280px; border:0; border-radius:12px; background:#fff}
    @media (max-width: 480px){ .map{height:240px} }

    .shortcut-list{display:flex;gap:8px;flex-wrap:wrap}
    .shortcut-list .btn{flex:1 1 140px}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <div class="top">
        <div class="crumbs">
          <span>Wholesaler</span><span class="dot"></span><span>Acquisition</span>
        </div>
        <div class="crumbs" id="status">Loading‚Ä¶</div>
      </div>

      <div class="toolbar">
        <button class="btn btn-blue" id="btnLeadMap">üó∫Ô∏è Lead Map</button>
        <button class="btn" id="btnOpenFs">‚§¢ Fullscreen</button>
        <button class="btn" id="btnReload">‚ü≥ Reload</button>
      </div>

      <!-- Sticky quick actions (always visible on scroll) -->
      <div class="quickbar" id="quickbar">
        <button class="qbtn call" id="qbCall">üìû Call</button>
        <button class="qbtn sms"  id="qbSMS">üí¨ SMS</button>
        <button class="qbtn mail" id="qbEmail">‚úâÔ∏è Email</button>
        <button class="qbtn note" id="qbNotes">üìù Update Notes</button>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <div class="panel">
          <div class="hd">Lead</div>
          <div class="pad">
            <div id="leadCard" class="lead">
              <div class="body">Initializing‚Ä¶</div>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="panel">
          <div class="hd">Shortcuts</div>
          <div class="pad">
            <div class="shortcut-list">
              <a class="btn" id="scCall"  target="_blank" rel="noopener">Call</a>
              <a class="btn" id="scSMS"   target="_blank" rel="noopener">SMS</a>
              <a class="btn" id="scEmail" target="_blank" rel="noopener">Email</a>
              <a class="btn" id="scNotes" target="_blank" rel="noopener">Update Lead Notes (Form)</a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Load leads with cache-bust -->
  <script>
    (function loadLeads(){
      const s=document.createElement('script');
      s.src = '/leads.js?v=' + Date.now();
      s.onload = ()=>{ window.leads = window.leads || window.leads_feed || window.leadsLatest || []; init(); };
      s.onerror= ()=>{ document.getElementById('status').textContent='Could not load /leads.js'; };
      document.head.appendChild(s);
    })();
  </script>

  <script>
    const $ = sel => document.querySelector(sel);
    let idx = 0;
    const statusEl = $('#status');
    const uid = new URL(location.href).searchParams.get('uid') || 'anon';

    function setStatus(t){ statusEl.textContent = t; }
    function phoneOf(lead){ return (lead?.contacts?.[0]?.phone || '').trim(); }

    function render(i){
      if(!Array.isArray(window.leads) || !window.leads.length){
        setStatus('No leads found. Check /leads.js path.');
        $('#leadCard').innerHTML = '<div class="body">No leads loaded. Ensure <b>/leads.js</b> defines <code>window.leads = [ ... ]</code>.</div>';
        return;
      }
      if(i<0) i = window.leads.length-1;
      if(i>=window.leads.length) i = 0;
      idx = i;

      const lead  = window.leads[idx];
      const name  = lead?.contacts?.[0]?.name || 'Unknown';
      const phone = phoneOf(lead);
      const addr  = lead?.address || '';
      const notes = (lead?.notes||'').replace(/\n/g,'<br>');

      setStatus(`Lead ${idx+1} of ${window.leads.length}`);

      // Map moved ABOVE details for faster context
      $('#leadCard').innerHTML = `
        <div class="title">${addr || name}</div>
        <div class="body">
          <div class="chips">
            <div class="chip">UID: ${uid.slice(0,8)}</div>
            <div class="chip">${phone ? 'Phone on file' : 'Phone missing'}</div>
          </div>

          <iframe class="map"
            src="https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed"
            loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

          <div style="display:flex;gap:8px;flex-wrap:wrap;margin:10px 0">
            <a class="btn" href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(addr)}" target="_blank" rel="noopener">Directions</a>
            <a class="btn" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(addr)}" target="_blank" rel="noopener">Open in Google Maps</a>
          </div>

          <details open>
            <summary>üìä Deal Details</summary>
            <div class="pad">${notes || 'No deal notes available.'}</div>
          </details>
        </div>
      `;

      // shortcuts + sticky quickbar wiring
      const callHref  = phone ? `tel:${phone}` : '#';
      const smsHref   = phone ? `sms:${phone}` : '#';
      const mailHref  = `mailto:?subject=${encodeURIComponent(name)} ‚Äî Lead&body=${encodeURIComponent(addr)}`;
      const notesHref = `https://docs.google.com/forms/d/e/1FAIpQLScIZ7GX_ga5yOx34817gOL8Bb5m3KFXW8r-5I4taw_-ergOxw/viewform?usp=pp_url&entry.849181096=${encodeURIComponent('Wholesaler')}&entry.121126280=${encodeURIComponent(name)}&entry.1828741519=${encodeURIComponent(addr)}`;

      $('#scCall').href  = callHref;
      $('#scSMS').href   = smsHref;
      $('#scEmail').href = mailHref;
      $('#scNotes').href = notesHref;

      $('#qbCall').onclick  = ()=> window.open(callHref,'_self');
      $('#qbSMS').onclick   = ()=> window.open(smsHref,'_self');
      $('#qbEmail').onclick = ()=> window.open(mailHref,'_self');
      $('#qbNotes').onclick = ()=> window.open(notesHref,'_blank','noopener');
    }

    // header buttons
    $('#btnOpenFs').onclick  = ()=> window.open(location.href,'_blank','noopener');
    $('#btnReload').onclick  = ()=> location.reload();
    $('#btnLeadMap').onclick = ()=> window.open('https://www.google.com/maps/d/u/0/viewer?mid=1C_OfzvCIlHnx-6nLaZ3Y88izZtflM5g&hl=en','_blank','noopener');

    // keyboard nav
    document.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowLeft')  return render(idx-1);
      if(e.key==='ArrowRight') return render(idx+1);
      if(e.key.toLowerCase()==='r') return render(Math.floor(Math.random()*(window.leads?.length||1)));
    });

    function init(){ if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', ()=>render(0)); } else { render(0); } }
  </script>
</body>
</html>
