<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Wholesaler • Acquisition</title>

<style>
  :root{
    --bg:#0d1822; --panel:#101c26; --card:#132431; --line:#213446;
    --text:#eaf1f6; --muted:#9fb3c7; --accent:#0d6efd; --accent-2:#0a58ca;
    --ok:#28a745; --shadow:0 20px 50px rgba(0,0,0,.45); --r:14px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;
    background:linear-gradient(135deg,#0b1218,#0e1a24 55%,#102434);
    color:var(--text);
  }

  .wrap{max-width:1080px; margin:0 auto; padding:16px}

  /* Top tools */
  .toolbar{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    background:var(--panel); border:1px solid var(--line); border-radius:var(--r);
    padding:10px 12px; box-shadow:var(--shadow);
  }
  .btn{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:10px; border:1px solid var(--line);
    background:#0f1a24; color:#eaf1f6; cursor:pointer; text-decoration:none; font-weight:600;
    white-space:nowrap;
  }
  .btn:hover{filter:brightness(1.06)}
  .btn.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2)); border:none}
  .btn.ok{background:linear-gradient(180deg,#2eb85c,#219a49); border:none}
  .spacer{flex:1}

  /* Card */
  .card{
    margin-top:14px; background:var(--panel); border:1px solid var(--line);
    border-radius:var(--r); box-shadow:var(--shadow); overflow:hidden;
  }
  .head{
    display:flex; gap:10px; align-items:center; padding:12px 14px; border-bottom:1px solid var(--line);
    background:linear-gradient(180deg,#0f1a24,#0c151d);
  }
  .controls{display:flex; gap:10px; flex-wrap:wrap; margin-left:auto}
  .chip{padding:6px 10px; border-radius:999px; border:1px solid var(--line); color:#cfe2f3; background:#0f1a24; font-size:12px}

  .body{padding:14px}
  .row{display:flex; gap:14px; flex-wrap:wrap}
  .col{flex:1 1 360px}
  .panel{background:var(--card); border:1px solid var(--line); border-radius:12px; padding:14px}
  .lead-name{font-weight:800; margin-bottom:4px}
  .lead-addr{color:#cfe2f3}

  .detail{margin-top:12px; border:1px dashed #2b4054; border-radius:10px; padding:10px; background:#0f1b25}
  .detail summary{cursor:pointer; color:#cfe2f3; font-weight:700}
  .kv{font-size:14px; color:#cfe2f3}

  iframe.map{width:100%; height:320px; border:0; border-radius:12px; background:#fff}

  /* Segmented switch */
  .seg{display:inline-flex; border:1px solid var(--line); border-radius:999px; overflow:hidden; background:#0f1a24}
  .seg button{padding:10px 16px; background:transparent; border:0; color:#cfe2f3; cursor:pointer; font-weight:600}
  .seg button.active{background:#112433}

  /* Notes */
  .notes{background:var(--card); border:1px solid var(--line); border-radius:12px; padding:12px}
  textarea{width:100%; min-height:180px; border:1px solid var(--line); border-radius:10px; background:#0f1a24; color:#eaf1f6; padding:10px}

  /* Shortcuts grid: tight, equal width */
  .shortcuts{
    display:grid; grid-template-columns:repeat(2,1fr); gap:10px;
  }

  /* Tiny icons */
  .i{width:16px; height:16px; display:inline-block}

  @media (min-width:980px){ iframe.map{height:420px} }
</style>
</head>
<body>
  <div class="wrap">

    <!-- TOP TOOLBAR -->
    <div class="toolbar">
      <div class="chip">Lead Map</div>
      <a class="btn" id="leadMap" href="https://www.google.com/maps/d/u/0/viewer?mid=1C_OfzvCIlHnx-6nLaZ3Y88izZtflM5g" target="_blank">
        <svg class="i" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.1 2 5 5.1 5 9c0 5.2 7 13 7 13s7-7.8 7-13c0-3.9-3.1-7-7-7zm0 9.5c-1.4 0-2.5-1.1-2.5-2.5S10.6 6.5 12 6.5s2.5 1.1 2.5 2.5S13.4 11.5 12 11.5z"/></svg>
        Open Lead Map
      </a>

      <div class="spacer"></div>

      <button class="btn" id="btnFullscreen">
        <svg class="i" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm0-4h2V7h3V5H7v5zm10 9h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
        Open Fullscreen
      </button>
      <button class="btn" id="btnReload">
        <svg class="i" viewBox="0 0 24 24" fill="currentColor"><path d="M12 6V3L8 7l4 4V8c2.8 0 5 2.2 5 5a5 5 0 11-5-5z"/></svg>
        Reload
      </button>
    </div>

    <!-- LEAD CARD -->
    <div class="card">
      <div class="head">
        <strong>Acquisition</strong>
        <span id="leadCount" class="chip">Loading…</span>
        <div class="controls">
          <button id="prevBtn" class="btn">Prev</button>
          <button id="randBtn" class="btn">Random</button>
          <button id="nextBtn" class="btn">Next</button>

          <a id="btnTextNow" class="btn primary" href="https://www.textnow.com/messaging" target="_blank">
            <svg class="i" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16v12H5.17L4 17.17V4zM2 2v20l4-4h16c1.1 0 2-.9 2-2V2H2z"/></svg>
            TextNow
          </a>
          <button id="copyBtn" class="btn ok">
            <svg class="i" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16h13c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2z"/></svg>
            Copy Phone
          </button>
        </div>
      </div>

      <div class="body">
        <div class="row">
          <!-- LEFT -->
          <div class="col">
            <div class="panel">
              <div class="lead-name" id="leadName">—</div>
              <div class="lead-addr" id="leadAddr">—</div>

              <details class="detail">
                <summary>Deal Details</summary>
                <div id="leadNotes" class="kv">No deal notes available.</div>
              </details>

              <div style="margin-top:12px; display:flex; align-items:center; gap:10px">
                <div class="seg" id="seg">
                  <button class="active" data-v="dir">Directions</button>
                  <button data-v="notes">Notes</button>
                </div>
                <a id="gmapsLink" class="btn" href="#" target="_blank">Open in Google Maps</a>
              </div>

              <div id="dirView" style="margin-top:12px">
                <iframe id="mapFrame" class="map" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
              </div>
              <div id="notesView" class="notes" style="display:none; margin-top:12px">
                <textarea id="notesBox" placeholder="Your call notes… (saving soon)"></textarea>
              </div>
            </div>
          </div>

          <!-- RIGHT -->
          <div class="col">
            <div class="panel">
              <div style="font-weight:700; margin-bottom:8px">Shortcuts</div>
              <div class="shortcuts">
                <a id="btnCall"  class="btn" href="#">Call</a>
                <a id="btnSMS"   class="btn" href="#">SMS</a>
                <a id="btnEmail" class="btn" href="#">Email</a>
                <a class="btn" target="_blank"
                   href="https://docs.google.com/forms/d/e/1FAIpQLScIZ7GX_ga5yOx34817gOL8Bb5m3KFXW8r-5I4taw_-ergOxw/viewform">
                   Update Lead Notes (Form)
                </a>
              </div>
            </div>
          </div>
        </div><!-- row -->
      </div><!-- body -->
    </div><!-- card -->
  </div><!-- wrap -->

  <script>
    // ---------- Try to load leads.js from several places ----------
    const CANDIDATE_PATHS = ["./leads.js", "/leads.js", "/data/leads.js"];
    function loadScript(src){
      return new Promise((resolve,reject)=>{
        const s = document.createElement('script');
        s.src = src; s.onload = ()=>resolve(src); s.onerror = ()=>reject(src);
        document.head.appendChild(s);
      });
    }
    async function ensureLeads(){
      for(const p of CANDIDATE_PATHS){
        try{ await loadScript(p); if (Array.isArray(window.leads)) return p; }catch(_){}
      }
      // Fallback: minimal sample, or paste your feed here to avoid 404s
      window.leads = window.leads || [
        // { address:"123 Sample St, San Antonio, TX", notes:"vacant; motivated seller", contacts:[{name:"Sample Owner", phone:"210-555-1212", email:""}] }
      ];
      return "fallback";
    }
  </script>

  <script>
    // DOM handles
    const $ = s => document.querySelector(s);
    const params     = new URL(location.href).searchParams;
    const uid        = params.get('uid') || '';
    const leadName   = $('#leadName');
    const leadAddr   = $('#leadAddr');
    const leadNotes  = $('#leadNotes');
    const leadCount  = $('#leadCount');
    const mapFrame   = $('#mapFrame');
    const gmapsLink  = $('#gmapsLink');
    const btnCall    = $('#btnCall');
    const btnSMS     = $('#btnSMS');
    const btnEmail   = $('#btnEmail');
    const btnCopy    = $('#copyBtn');
    const seg        = $('#seg');
    const dirView    = $('#dirView');
    const notesView  = $('#notesView');

    let L = [];
    let i = 0;

    function cleanText(t){ return (t || '').replace(/\s+/g,' ').trim(); }
    function highlight(text){
      if (!text) return 'No deal notes available.';
      const keywords = ["asbestos","vacant","fha","foreclosure","build","loan","occupied","equity","taxes","motivated","carryback"];
      const re = new RegExp(`\\b(${keywords.join('|')})\\b`,'gi');
      return text.replace(re,'<strong style="color:#fff;background:#214;padding:0 3px;border-radius:4px">$1</strong>').replace(/\n/g,'<br>');
    }
    const gmEmbed = addr => `https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed`;

    function setLead(idx){
      if (!L.length){
        leadCount.textContent = 'No leads found. Check leads.js path.';
        return;
      }
      i = (idx + L.length) % L.length;
      const lead  = L[i];
      const name  = lead?.contacts?.[0]?.name  || '—';
      const phone = lead?.contacts?.[0]?.phone || '';
      const email = lead?.contacts?.[0]?.email || '';
      const addr  = cleanText(lead?.address || '');

      leadName.textContent = name;
      leadAddr.textContent = addr || '—';
      leadNotes.innerHTML  = highlight(lead?.notes);

      if (addr) {
        mapFrame.src = gmEmbed(addr);
        gmapsLink.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(addr)}`;
      } else {
        mapFrame.removeAttribute('src');
        gmapsLink.removeAttribute('href');
      }

      btnCall.href  = phone ? `tel:${phone}`  : '#';
      btnSMS.href   = phone ? `sms:${phone}`  : '#';
      btnEmail.href = email ? `mailto:${email}`: '#';
      btnCopy.onclick = () => phone ? navigator.clipboard.writeText(phone).then(()=>alert('Copied: '+phone)) : alert('No phone on file.');

      $('#btnFullscreen').onclick = ()=> window.open(`${location.pathname}?uid=${encodeURIComponent(uid)}&i=${i}`,'_blank');
      $('#btnReload').onclick     = ()=> location.reload();

      $('#prevBtn').onclick = ()=> { setLead(i-1); updateCount(); };
      $('#nextBtn').onclick = ()=> { setLead(i+1); updateCount(); };
      $('#randBtn').onclick = ()=> { setLead(Math.floor(Math.random()*L.length)); updateCount(); };

      updateCount();
    }

    function updateCount(){
      if (!L.length){ leadCount.textContent = 'No leads.'; return; }
      leadCount.textContent = `Loaded ${L.length} lead(s). Showing #${(i+1)}.`;
    }

    async function boot(){
      const src = await ensureLeads(); // tries to load leads.js
      L = Array.isArray(window.leads) ? window.leads.slice() : [];
      if (src !== "fallback" && !L.length){
        leadCount.textContent = `Couldn’t read leads from ${src}.`;
      }
      const start = parseInt(params.get('i')||'0',10);
      setLead(start);
    }
    boot();

    // segmented toggle
    seg.addEventListener('click', e=>{
      const b = e.target.closest('button'); if (!b) return;
      [...seg.children].forEach(x=>x.classList.toggle('active', x===b));
      const v = b.dataset.v;
      dirView.style.display   = (v==='dir')   ? '' : 'none';
      notesView.style.display = (v==='notes') ? '' : 'none';
    });
  </script>
</body>
</html>
