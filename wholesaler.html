<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wholesaler • Portal</title>
<link rel="icon" href="images/db-badge.png"/>
<style>
  :root{--bg:#0f1a22;--panel:#13202a;--text:#cfe7ff}
  html,body{background:var(--bg);color:var(--text);margin:0;font:16px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .shell{max-width:1100px;margin:28px auto;padding:0 16px}
  .bar{background:#1a2b36;border-radius:14px;padding:12px;display:flex;gap:10px;align-items:center;justify-content:space-between}
  .btn{background:#233748;color:#d8ebff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn.gold{background:#6b4b12;color:#ffd166}
  .btn.red{background:#662424;color:#ffdede}
  .btn.blue{background:#1f3b63;color:#d7e9ff}
  .card{background:#13202a;border-radius:14px;padding:14px;margin-top:12px}
</style>
<script src="config.js"></script>
<script src="app-auth.js" type="module"></script>
</head>
<body>
<div class="shell">
  <div class="bar">
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn red" onclick="openImmediateSupport()">Immediate Support</button>
      <button class="btn blue" onclick="openStandardSupport()">Standard Support</button>
      <button class="btn gold" onclick="goto('claims-exchange.html')">Claims Exchange</button>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn" onclick="goto('profile.html')">Back to Profile</button>
      <button class="btn" onclick="logout()">Log Out</button>
    </div>
  </div>

  <div class="card" id="gateMsg">Checking access…</div>
  <div class="card" id="content" style="display:none">
    <div>Acquisition & Disposition tools restored here. (Leads table loads after gate.)</div>
  </div>
</div>

<script type="module">
import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
const { gate, db, uid } = window;

// Gate = wholesaler or admin
gate({ role: "wholesaler" })
  .then(async ()=>{
    document.getElementById("gateMsg").style.display="none";
    const content = document.getElementById("content");
    content.style.display="";
    // Example: live leads list for this user (or all if admin)
    const u = uid();
    const isAdmin = (await window.getRole(u)) === "admin";
    const path = isAdmin ? "live/deals" : `dispo/${u}/deals`;
    const c = document.createElement("div");
    c.innerHTML = `<div style="opacity:.8">Loading from <code>${path}</code>…</div>`;
    content.appendChild(c);
    onValue(ref(db, path), (snap)=>{
      const area = document.createElement("pre");
      area.textContent = JSON.stringify(snap.val()||{}, null, 2);
      c.replaceWith(area);
    });
  })
  .catch((e)=>{
    document.getElementById("gateMsg").textContent = "Could not verify access right now. Try again shortly.";
  });
</script>
</body>
</html>
