<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Wholesaler Workspace</title>
<link rel="icon" type="image/jpeg" href="icon (1).jpg"/>

<style>
  :root{
    --bg:#0d1822; --panel:#0f1a24; --card:#12202d; --line:#203241;
    --text:#eaf1f6; --muted:#9fb3c7; --accent:#0d6efd; --green:#28a745; --dark:#0b141b;
    --shadow:0 18px 42px rgba(0,0,0,.45); --r:14px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;
    background: radial-gradient(900px 500px at 85% -10%, #133243 0%, transparent 60%),
               linear-gradient(135deg,#0b1218,#0e1a24 50%,#102434);
    color:var(--text); min-height:100vh; padding:16px;
  }
  .wrap{max-width:1100px;margin:0 auto}
  .card{background:#10202c;border:1px solid #1a2a36;border-radius:var(--r);box-shadow:var(--shadow)}
  .head{padding:16px 18px;border-bottom:1px solid #1a2a36}
  .head h1{margin:0;font-size:22px}
  .muted{color:var(--muted);font-size:13px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;padding:12px 12px;border-bottom:1px solid #1a2a36}
  .btn{padding:10px 12px;border-radius:10px;border:1px solid #1d3142;background:#0f1a24;color:#cfe2f3;cursor:pointer}
  .btn:hover{filter:brightness(1.06)}
  .btn-green{background:linear-gradient(180deg,#29a84a,#1f8a39);border:none;color:#fff}
  .grid{display:grid;grid-template-columns:1fr 340px;gap:14px;padding:14px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .panel{background:#0f1a24;border:1px solid #1a2a36;border-radius:var(--r);overflow:hidden}
  .panel h3{margin:0;padding:12px 14px;border-bottom:1px solid #1a2a36;font-size:16px}
  .pad{padding:12px 14px}

  .lead-box{background:#0f1a24;border:1px solid #1a2a36;border-radius:12px;margin-bottom:12px;overflow:hidden}
  .lead-title{padding:12px 14px;font-weight:700;border-bottom:1px solid #1a2a36}
  .lead-body{padding:12px 14px}
  details{background:#0c1620;border:1px solid #1a2a36;border-radius:10px;overflow:hidden}
  summary{cursor:pointer;padding:10px 12px;font-weight:600}
  .chiprow{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
  .chip{padding:6px 10px;border-radius:999px;background:#0d2230;border:1px solid #203241;font-size:12px}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .actions .btn{flex:0 0 auto}
  .map-embed{width:100%;height:260px;border:0;border-radius:10px;background:#fff}
  .status{font-size:12px;color:#9fb3c7;margin:6px 0}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <h1>Wholesaler Workspace</h1>
        <div class="muted">Acquisition and Disposition tools live side-by-side. Use the main profile tabs to switch.</div>
      </div>

      <div class="toolbar">
        <button class="btn" id="btnLeadMap">üó∫Ô∏è Open Lead Map</button>
        <button class="btn" id="btnOpenFs">‚§¢ Open Fullscreen</button>
        <button class="btn" id="btnReload">‚ü≥ Reload</button>
        <span class="status" id="status">Loading leads‚Ä¶</span>
      </div>

      <div class="grid">
        <!-- LEFT: lead + notes -->
        <div class="panel">
          <h3 id="leadHeader">Acquisition</h3>
          <div class="pad">

            <div class="actions" style="margin-bottom:6px">
              <button class="btn" id="btnPrev">‚óÄ Prev</button>
              <button class="btn" id="btnRandom">üé≤ Random</button>
              <button class="btn" id="btnNext">Next ‚ñ∂</button>
              <button class="btn" id="btnTextNow">TextNow</button>
              <button class="btn btn-green" id="btnCopyPhone">Copy Phone</button>
            </div>

            <div class="lead-box" id="leadCard">
              <!-- lead injected here -->
            </div>

          </div>
        </div>

        <!-- RIGHT: shortcuts -->
        <div class="panel">
          <h3>Shortcuts</h3>
          <div class="pad">
            <div class="actions">
              <a class="btn" id="scCall" target="_blank" rel="noopener">Call</a>
              <a class="btn" id="scSMS"  target="_blank" rel="noopener">SMS</a>
              <a class="btn" id="scEmail" target="_blank" rel="noopener">Email</a>
              <a class="btn" id="scNotes" target="_blank" rel="noopener">Update Lead Notes (Form)</a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Your leads file: absolute path + cache-buster -->
  <script src="/leads.js?v=20250810"></script>
  <script>
    // Normalize to window.leads
    window.leads = window.leads || window.leads_feed || window.leadsLatest || [];

    // Helpers
    const $ = s => document.querySelector(s);
    const statusEl = $('#status');
    let idx = 0;

    const uid = new URL(location.href).searchParams.get('uid') || 'anon';

    function setStatus(t){ if(statusEl) statusEl.textContent = t; }

    function phoneOf(lead){
      const p = lead?.contacts?.[0]?.phone || '';
      return (p || '').trim();
    }

    function renderLead(i){
      if(!Array.isArray(window.leads) || window.leads.length===0){
        setStatus('No leads found. Check /leads.js path.');
        $('#leadCard').innerHTML =
          '<div class="lead-body">No leads loaded. Ensure /leads.js exists and defines window.leads = [ ... ].</div>';
        return;
      }
      if(i<0) i=window.leads.length-1;
      if(i>=window.leads.length) i=0;
      idx=i;

      const lead = window.leads[idx];
      const name = lead?.contacts?.[0]?.name || 'Unknown';
      const phone = phoneOf(lead);
      const addr = lead?.address || '';
      const notes = (lead?.notes || '').replace(/\n/g,'<br>');

      setStatus(`Lead ${idx+1} of ${window.leads.length}`);

      $('#leadCard').innerHTML = `
        <div class="lead-title">${name}</div>
        <div class="lead-body">
          <div style="margin-bottom:8px">${addr}</div>

          <details>
            <summary>üìä Deal Details</summary>
            <div class="pad">${notes || 'No deal notes available.'}</div>
          </details>

          <div class="chiprow">
            <div class="chip">UID: ${uid.slice(0,8)}</div>
            <div class="chip">${phone ? 'Phone on file' : 'Phone missing'}</div>
          </div>

          <div class="actions">
            <a class="btn" href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(addr)}" target="_blank" rel="noopener">Directions</a>
            <a class="btn" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(addr)}" target="_blank" rel="noopener">Open in Google Maps</a>
          </div>

          <iframe class="map-embed"
            src="https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed"
            loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      `;

      // Shortcuts
      $('#scCall').href  = phone ? `tel:${phone}` : '#';
      $('#scSMS').href   = phone ? `sms:${phone}` : '#';
      $('#scEmail').href = `mailto:?subject=${encodeURIComponent(name)} ‚Äî Lead`;
      $('#scNotes').href = `https://docs.google.com/forms/d/e/1FAIpQLScIZ7GX_ga5yOx34817gOL8Bb5m3KFXW8r-5I4taw_-ergOxw/viewform?usp=pp_url&entry.849181096=${encodeURIComponent('Wholesaler')}&entry.121126280=${encodeURIComponent(name)}&entry.1828741519=${encodeURIComponent(addr)}`;
    }

    // Buttons
    $('#btnPrev').onclick   = ()=> renderLead(idx-1);
    $('#btnNext').onclick   = ()=> renderLead(idx+1);
    $('#btnRandom').onclick = ()=> renderLead(Math.floor(Math.random()* (window.leads?.length||1)));
    $('#btnTextNow').onclick= ()=> window.open('https://www.textnow.com/messaging','_blank','noopener');
    $('#btnCopyPhone').onclick = ()=>{
      const p = phoneOf(window.leads[idx]);
      if(!p) return alert('No phone on this lead.');
      navigator.clipboard.writeText(p).then(()=>alert('Copied: '+p));
    };

    $('#btnLeadMap').onclick = ()=> window.open('https://www.google.com/maps/d/u/0/viewer?mid=1C_OfzvCIlHnx-6nLaZ3Y88izZtflM5g&hl=en','_blank','noopener');
    $('#btnOpenFs').onclick  = ()=> window.open(location.href,'_blank','noopener');
    $('#btnReload').onclick  = ()=> location.reload();

    // Initial render
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', ()=> renderLead(0));
    } else {
      renderLead(0);
    }
  </script>
</body>
</html>
