<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DealBankers ‚Ä¢ Sign in</title>
  <meta name="robots" content="noindex"/>

  <!-- Compat SDKs (one set, consistent version) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Your firebaseConfig (must define window.firebaseConfig) -->
  <script src="config.js"></script>

  <style>
    :root{--bg:#0b1118;--panel:#101c27;--line:#1f3550;--text:#eaf1f6;--muted:#9fb3c7;--green:#26cf84;}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(135deg,#0b1118,#0e1a24 55%,#10283a);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .wrap{display:grid;grid-template-columns:1fr 1fr;gap:24px;max-width:980px;width:100%}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.15);border-radius:18px;padding:18px;box-shadow:0 24px 64px rgba(0,0,0,.5)}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:64px;height:64px;border-radius:12px;object-fit:cover}
    .title{font-weight:900;font-size:20px;margin:0}
    .muted{color:var(--muted);font-size:13px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:#0f1a24;color:#eaf1f6;cursor:pointer;width:100%}
    .btn:disabled{opacity:.6;cursor:default}
    .status{margin-top:10px;font-size:12px;color:#cfe0f2}
    @media (max-width:880px){ .wrap{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">
        <img src="icon (1).jpg" alt="">
        <div>
          <h2 class="title">DealBankers</h2>
          <div class="muted">Secure access to your acquisitions & dispositions portals. Sign in with Google to continue.</div>
        </div>
      </div>
    </div>

    <div class="card" id="authCard">
      <h3 style="margin:0 0 10px">üîê Secure Sign-In</h3>
      <button id="googleBtn" class="btn"><span>üîµ</span> Sign in with Google</button>
      <div id="authStatus" class="status">Auth status: checking‚Ä¶</div>
    </div>
  </div>

  <script>
    // ---------- One-time Firebase init (compat) ----------
    (function initFirebase(){
      try{
        if(!window.firebaseConfig) throw new Error('Missing window.firebaseConfig (config.js)');
        if(!firebase?.apps?.length) firebase.initializeApp(window.firebaseConfig);
        window.db   = firebase.database();
        window.auth = firebase.auth();
      }catch(e){
        document.getElementById('authStatus').textContent = 'Firebase init error: ' + (e.message||e);
        console.error(e);
      }
    })();

    // ---------- Auth wiring ----------
    (function(){
      const statusEl = document.getElementById('authStatus');
      const btn      = document.getElementById('googleBtn');
      let navigated  = false; // prevent double redirects

      function go(path){
        if(navigated) return; navigated = true;
        location.href = path;
      }

      if (!window.auth){
        statusEl.textContent = 'Firebase not ready. Check config.js.';
        btn.disabled = true;
        return;
      }

      // If already signed in, jump straight to profile
      auth.onAuthStateChanged(function(user){
        if(user){ statusEl.textContent = 'Signed in. Redirecting‚Ä¶'; go('profile.html'); }
        else { statusEl.textContent = 'Not signed in.'; btn.disabled = false; }
      });

      btn.addEventListener('click', async ()=>{
        btn.disabled = true; statusEl.textContent = 'Opening Google‚Ä¶';
        try{
          const prov = new firebase.auth.GoogleAuthProvider();
          await auth.signInWithPopup(prov);
          statusEl.textContent = 'Signed in. Redirecting‚Ä¶';
          go('profile.html');
        }catch(e){
          console.error(e);
          statusEl.textContent = 'Sign-in failed: ' + (e.message||e);
          btn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
