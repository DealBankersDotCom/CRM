<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DealBankers â€” Real Estate Command Hub</title>
<link rel="icon" type="image/jpeg" href="icon (1).jpg" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="config.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');

:root {
  --bg: #060b11;
  --accent: #2b74ff;
  --accent-glow: #4f8cff;
  --text: #eaf2ff;
  --line: #1e2c3a;
  --muted: #9db2c7;
  --chrome: #a8c1ff;
  --neon: #33aaff;
}

/* Reset */
* {box-sizing:border-box;margin:0;padding:0;}
body {
  font-family: "Orbitron", system-ui, sans-serif;
  background: radial-gradient(circle at 30% 10%, #0b1523 0%, #050910 100%);
  color: var(--text);
  overflow-x: hidden;
  animation: dashFlicker 2s ease-in-out;
}

/* DeLorean Dash Flicker */
@keyframes dashFlicker {
  0% {opacity:0;}
  10% {opacity:0.2;}
  20% {opacity:0.5;}
  40% {opacity:0.1;}
  60% {opacity:0.7;}
  100% {opacity:1;}
}

/* Header */
header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 20px;
  border-bottom:1px solid var(--line);
  background:linear-gradient(90deg,#070d16,#0e1b30 80%,#070d16);
  box-shadow:0 0 18px rgba(43,116,255,0.25);
}
.brand {
  display:flex;align-items:center;gap:10px;
  font-weight:800;letter-spacing:1px;color:var(--chrome);
}
.brand img {width:42px;height:42px;border-radius:10px;box-shadow:0 0 10px var(--neon);}
nav {display:flex;gap:10px;}
nav a {
  padding:6px 14px;border-radius:8px;background:#162238;
  font-weight:700;color:#bcd1ff;transition:.25s;
}
nav a:hover {
  background:var(--accent);color:#fff;box-shadow:0 0 12px var(--accent-glow);
}
.status {font-size:.8rem;color:var(--muted);}

/* Layout */
main {
  display:grid;grid-template-columns:1.1fr .9fr;gap:20px;
  max-width:1200px;margin:40px auto;padding:0 16px;
  animation:fadeIn .8s ease-in;
}
@keyframes fadeIn {
  from {opacity:0;transform:translateY(20px);}
  to {opacity:1;transform:none;}
}

.left-col,.right-col {
  background:rgba(15,24,35,.4);
  border:1px solid var(--line);
  border-radius:14px;
  padding:24px;
  box-shadow:inset 0 0 20px rgba(43,116,255,.15);
}

/* Hero */
.hero {text-align:center;margin-bottom:24px;}
.hero h1 {font-size:2.4rem;margin-bottom:6px;color:var(--chrome);}
.hero p {color:#b5cbe0;margin-bottom:20px;}

.gbtn {
  display:inline-flex;align-items:center;justify-content:center;gap:10px;
  padding:12px 20px;border-radius:12px;border:1px solid #747775;
  background:#1f1f1f;color:#e8eaed;font-weight:700;cursor:pointer;font-size:1rem;
  box-shadow:0 0 10px rgba(43,116,255,.3);
}
.gbtn:hover {
  background:#2c2c2c;box-shadow:0 0 14px var(--accent-glow);
}
.gbtn img {width:20px;height:20px;}

/* Tiles */
.tiles {
  display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;margin-top:10px;
}
.tile {
  background:linear-gradient(180deg,#111b27,#0c1219);
  border:1px solid #1d2b3a;
  border-radius:16px;padding:20px;text-align:center;
  transition:.3s;cursor:pointer;
}
.tile:hover {
  transform:translateY(-5px);
  box-shadow:0 0 20px rgba(43,116,255,.4);
}
.tile h3 {margin:6px 0;color:#fff;font-size:1.1rem;}
.tile p {font-size:.9rem;color:#9db2c7;}

/* Chat */
.townhall h2 {
  text-align:center;margin-bottom:12px;color:var(--chrome);
  text-shadow:0 0 5px var(--accent);
}
.chat-container {
  border-radius:14px;background:rgba(15,24,35,.7);
  border:1px solid #1e2c3a;padding:16px;display:flex;flex-direction:column;
  height:480px;box-shadow:inset 0 0 12px rgba(43,116,255,.25);
}
.chat-messages {flex:1;overflow-y:auto;padding-right:4px;}
.msg {margin-bottom:10px;padding:10px;border-radius:10px;background:rgba(255,255,255,.05);}
.msg strong {color:var(--neon);}
.msg small {color:#9db2c7;font-size:.7rem;margin-left:4px;}
.chat-input {display:flex;gap:10px;margin-top:10px;}
.chat-input input {
  flex:1;padding:10px;border-radius:10px;border:1px solid #294861;
  background:#0e2332;color:#fff;
}
.chat-input button {
  padding:10px 14px;border-radius:10px;border:1px solid var(--accent);
  background:#173764;color:#fff;font-weight:700;cursor:pointer;
}
.chat-input button:hover {background:var(--accent);box-shadow:0 0 10px var(--accent-glow);}

/* Loader */
#loader {
  position:fixed;inset:0;background:rgba(6,11,17,0.95);
  display:none;align-items:center;justify-content:center;
  flex-direction:column;z-index:9999;color:#fff;font-size:1.2rem;
}
.loader-spinner {
  width:50px;height:50px;border:5px solid #1e2c3a;
  border-top:5px solid var(--accent);border-radius:50%;
  animation:spin 1s linear infinite;margin-bottom:12px;
}
@keyframes spin {100%{transform:rotate(360deg);}}

/* Footer */
footer {text-align:center;margin:40px auto;color:#88a5bf;font-size:.9rem;}
footer span {display:block;margin-top:4px;color:var(--accent);font-weight:700;}

@media(max-width:900px){main{grid-template-columns:1fr;gap:30px;}.chat-container{height:400px;}}
</style>
</head>

<body>
<header>
  <div class="brand"><img src="icon (1).jpg" alt=""><span>DealBankers</span></div>
<nav>
  <a href="#">Home</a>
  <a href="https://www.dealbankers.com/profile.html">Tools</a>
  <a href="#townhall">Townhall</a>
  <a href="claimsync.html">ClaimSync</a>
</nav>

  <div class="status" id="authStatus">Signed out</div>
</header>

<!-- Loader overlay -->
<div id="loader">
  <div class="loader-spinner"></div>
  <div>Initializing systems...</div>
</div>

<main>
  <div class="left-col">
    <div class="hero">
      <h1>DealBankers</h1>
      <p>Your One-Stop Real Estate Portal</p>
      <button id="googleBtn" class="gbtn">
        <img src="https://developers.google.com/identity/images/g-logo.png" alt=""> Sign in with Google
      </button>
    </div>
    <div id="tools" class="tiles">
      <div class="tile"><h3>Transactional Coordinating</h3><p>Document flow, title coordination, compliance.</p></div>
      <div class="tile"><h3>Property Analysis</h3><p>Valuation tools powered by market data.</p></div>
      <div class="tile"><h3>Skip Tracing</h3><p>Owner & contact lookup services.</p></div>
      <div class="tile"><h3>Wholesalers</h3><p>Upload leads, request campaigns, partnerships.</p></div>
      <div class="tile"><h3>Contractors</h3><p>Claim jobs, request micro-loans, manage tools.</p></div>
      <div class="tile"><h3>Realtors</h3><p>Access training, analysis, and leads.</p></div>
      <div class="tile" style="grid-column:1 / -1;justify-self:center;max-width:240px">
        <h3>Investors</h3><p>Raise & deploy capital, manage notes, post updates.</p>
      </div>
    </div>
  </div>

  <div class="right-col townhall" id="townhall">
    <h2>ðŸ”µ Townhall Chat (Live)</h2>
    <div class="chat-container">
      <div id="messages" class="chat-messages"></div>
      <div class="chat-input">
        <input id="msgInput" type="text" placeholder="Sign in to chat..." disabled>
        <button id="sendBtn" disabled>Send</button>
      </div>
    </div>
  </div>
</main>

<footer>
  Â© <span id="year"></span> DealBankers.com
  <span>Tread Lightly. Carry a Big Stick.</span>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

let db, auth, user;
function esc(s){return(''+(s||'')).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

function attachChat(){
  const msgList=document.getElementById('messages');
  const ref=db.ref('townhall/messages').limitToLast(50);
  msgList.innerHTML='';
  ref.on('child_added',snap=>{
    const d=snap.val()||{};
    const t=new Date(d.ts||Date.now()).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const div=document.createElement('div');
    div.className='msg';
    div.innerHTML = "<strong>" + esc(d.name || 'Anon') + "</strong> <small>" + t + "</small><div>" + esc(d.text || '') + "</div>";
    msgList.appendChild(div);
    msgList.scrollTop=msgList.scrollHeight;
  });
}

window.addEventListener('load', async () => {
  const loader = document.getElementById('loader');
  loader.style.display = 'flex';

  try {
    // Firebase init guard
    if (!firebase.apps.length) {
      console.error("Firebase not initialized");
      alert("Firebase config error.");
      return;
    }

    db = firebase.database();
    auth = firebase.auth();

    const googleBtn=document.getElementById('googleBtn');
    const statusEl=document.getElementById('authStatus');
    const msgInput=document.getElementById('msgInput');
    const sendBtn=document.getElementById('sendBtn');

    attachChat();
    loader.style.display = 'none';

    let signingIn = false;
    googleBtn.addEventListener('click', async () => {
      if (signingIn) return;
      signingIn = true;
      loader.style.display = 'flex';
      loader.querySelector('div:last-child').textContent = 'Signing you in...';

      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
        await auth.signInWithPopup(provider);
      } catch (e) {
        console.error("Auth error:", e);
        alert("Sign-in failed. Please try again.");
      } finally {
        loader.style.display = 'none';
        signingIn = false;
      }
    });

    auth.onAuthStateChanged(u => {
      user = u;
      if (u) {
        statusEl.innerHTML = `Signed in as ${u.displayName||u.email} <a id='logout' style='color:#2b74ff;cursor:pointer;margin-left:6px;'>Sign out</a>`;
        document.getElementById('logout').onclick = () => auth.signOut();
        msgInput.disabled = false;
        sendBtn.disabled = false;
        msgInput.placeholder = "Type your message...";
      } else {
        statusEl.textContent = 'Signed out';
        msgInput.disabled = true;
        sendBtn.disabled = true;
        msgInput.placeholder = "Sign in to chat...";
      }
    });

    function sendMsg() {
      if (!user) { alert('Please sign in first.'); return; }
      const text = msgInput.value.trim();
      if (!text) return;
      db.ref('townhall/messages').push({
        uid: user.uid,
        name: user.displayName || user.email,
        text,
        ts: firebase.database.ServerValue.TIMESTAMP
      });
      msgInput.value = '';
    }

    sendBtn.onclick = sendMsg;
    msgInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') { e.preventDefault(); sendMsg(); }
    });

  } finally {
    loader.style.display = 'none';
  }
});
</script>
</body>
</html>
