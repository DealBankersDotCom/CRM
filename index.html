<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DealBankers — Wholesale & Discount Deals (Map)</title>
<link rel="icon" type="image/jpeg" href="icon (1).jpg"/>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

<!-- Firebase compat (same stack as before) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
<!-- Your local config & auth helpers -->
<script src="config.js"></script>
<script src="app-auth.js"></script>

<style>
  :root{
    --bg:#0b1218; --panel:#0f1823; --line:#1e2c3a;
    --text:#eaf2ff; --muted:#9db2c7; --accent:#2b74ff; --chip:#0e2332;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:linear-gradient(135deg,#0b1218,#0e1a25 60%,#0b1218); color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial}

  .header{position:sticky;top:0;z-index:30;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--line);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02))}
  .brand{display:flex;gap:10px;align-items:center}
  .brand img{width:36px;height:36px;border-radius:10px;object-fit:cover}
  .chip{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border-radius:999px;border:1px solid #294861;background:var(--chip);
        color:#d7ecff;text-decoration:none;font-weight:700}

  .shell{max-width:1180px;margin:14px auto;padding:0 12px}

  /* 2-col layout: main + secure access */
  .cols{display:grid;grid-template-columns:1fr 320px;gap:14px}
  @media (max-width: 980px){ .cols{grid-template-columns:1fr} }

  .panel{border:1px solid var(--line);border-radius:14px;background:var(--panel)}

  /* Map */
  #map{height:420px;border-radius:14px}
  .mapbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;padding:10px}
  .legend{display:flex;gap:10px;flex-wrap:wrap}
  .legend span{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)}
  .dot{width:10px;height:10px;border-radius:50%}
  .dot.featured{background:#2b74ff}
  .dot.swift{background:#caa86a}

  /* Details grid */
  .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
  .card{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02))}
  .thumb{aspect-ratio:4/3;width:100%;object-fit:cover;background:#08111a}
  .pad{padding:12px}
  .title{font-weight:800;margin:0 0 4px}
  .meta{color:#b5cbe0;font-size:12px}
  .row{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .btn{padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:#102433;color:#dff1ff;font-weight:700;text-decoration:none}
  .btn.primary{background:#0f2945}
  .tag{display:inline-flex;align-items:center;gap:6px;background:#0e2332;border:1px solid #294861;border-radius:8px;padding:4px 8px;font-size:12px;color:#cfe3ff}

  .notice{margin:12px 0;padding:10px 12px;border:1px dashed var(--line);border-radius:12px;color:#cfe3ff;background:#0c1a25;font-size:13px}

  /* Secure Access card */
  .secure{border:1px solid var(--line);border-radius:16px;background:#0f1a24;padding:14px}
  .gbtn{
    display:flex;align-items:center;justify-content:center;gap:10px;
    height:44px;width:100%;border-radius:12px;border:1px solid #747775;
    background:#1f1f1f;color:#e8eaed;font-weight:700;cursor:pointer
  }
  .gbtn img{width:18px;height:18px}
  .status{color:var(--muted);font-size:12px;margin-top:8px}

  @media (max-width: 980px){ .cards{grid-template-columns:1fr 1fr} #map{height:360px} }
  @media (max-width: 640px){ .cards{grid-template-columns:1fr} #map{height:320px} }
</style>
</head>
<body>
<header class="header">
  <div class="brand"><img src="icon (1).jpg" alt=""><b>DealBankers</b></div>
  <a class="chip" href="claims-exchange.html">Claims Exchange</a>
</header>

<div class="shell cols">
  <!-- Left: Map + Deals -->
  <main>
    <div class="panel">
      <div class="mapbar">
        <div><b>Deals Map</b> — tap a pin to open details ↓</div>
        <div class="legend">
          <span><i class="dot featured"></i> Featured inventory</span>
          <span><i class="dot swift"></i> Offmarket Deals</span>
        </div>
      </div>
      <div id="map"></div>
    </div>

    <div class="notice">
      All properties below are under contract and we are assigning our interest as buyer for an assignment fee, or we own the property.
      Wholesalers &amp; Realtors: we JV—tell us upfront and we’ll work with you. To make an offer call/text <b>512-843-5181</b>.
    </div>

    <!-- Details cards auto-render here -->
    <div id="cards" class="cards"></div>
  </main>

  <!-- Right: Secure Access / Login -->
  <aside class="secure">
    <h3 style="margin:0 0 8px">Secure Access</h3>
    <div class="meta" style="margin-bottom:10px">Sign in to continue to your portal.</div>
    <button id="googleBtn" class="gbtn">
      <img src="https://developers.google.com/identity/images/g-logo.png" alt="">
      Continue with Google
    </button>
    <div class="status">Status: <span data-auth-status>signed out</span></div>
    <div class="status" style="margin-top:10px">If pop-ups are blocked we’ll fall back to redirect sign-in.</div>
  </aside>
</div>

<script>
/* ========= Auth card (same behavior as before) ========= */
(function(){
  const btn = document.getElementById('googleBtn');
  const statusEl = document.querySelector('[data-auth-status]');
  function setStatus(s){ if(statusEl) statusEl.textContent = s; }

  btn?.addEventListener('click', async ()=>{
    try{
      const provider = new firebase.auth.GoogleAuthProvider();
      await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
      await firebase.auth().signInWithPopup(provider);
    }catch(e){
      if(e?.code === 'auth/popup-blocked'){
        const provider = new firebase.auth.GoogleAuthProvider();
        return firebase.auth().signInWithRedirect(provider);
      }
      alert('Sign-in failed. Try again.');
    }
  });

  firebase.auth().onAuthStateChanged(u=> setStatus(u ? 'signed in' : 'signed out'));
})();

/* =======================
   DEALS DATA
======================= */
const deals = [
  // Featured inventory
  {
    id:"booth", group:"featured",
    title:"Booth St, San Antonio, TX",
    address:"Booth St, San Antonio, TX",
    summary:"3/2 • 1,798 sf • AVM ≈ $347k",
    price:null,
    photos:["images/deals/booth-st/20250124_171821.jpg","images/deals/booth-st/20250429_194536.jpg"],
    links:{},
  },
  {
    id:"sanluis", group:"featured",
    title:"San Luis St, San Antonio, TX",
    address:"San Luis St, San Antonio, TX",
    summary:"Lot with structure • RM-4 • Ask $65,000 (wholesale)",
    price:"$65,000",
    photos:["images/deals/san-luis-st/7.png","images/deals/san-luis-st/12.png"],
    links:{}
  },
  {
    id:"veracruz", group:"featured",
    title:"Vera Cruz St, San Antonio, TX",
    address:"Vera Cruz St, San Antonio, TX",
    summary:"Infill lot • City utilities • Wholesale pricing",
    price:null,
    photos:["images/deals/vera-cruz-st/12.png","images/deals/vera-cruz-st/7.png"],
    links:{}
  },

  // Swift Sell (Mitzi)
  {
    id:"mh-move-2018-waukee", group:"swift",
    title:"2018 2/2 Singlewide — Needs To Be Moved",
    address:"942 Waukee Pass St, San Antonio, TX 78260",
    summary:"840 sf (14x60) • Label NTA1825234 • No repairs • Ready to move",
    price:"$42,000",
    photos:[],
    links:{
      pictures:"https://drive.google.com/drive/folders/1yU_TdvSxaSzt0CLsM6lSWoupHd6jNpmD?usp=sharing",
      craigslist:"https://sanantonio.craigslist.org/reo/d/san-antonio-2018-singlewide-bd-ba-to-be/7869586869.html"
    }
  },
  {
    id:"land-lakehills", group:"swift",
    title:"Commercial Land great for Storage Units (1.197 acres)",
    address:"9896 Park Road 37, Lakehills, TX 78063",
    summary:"Outside large residential community — leveled, driveway permit in pics",
    price:"$60,000",
    photos:[],
    links:{ pictures:"https://drive.google.com/drive/folders/1dkmwEWVhW3TIwMG5j-45uBGtfGzkf1R7?usp=drive_link" }
  },
  {
    id:"floresville-rto", group:"swift",
    title:"4/2 Doublewide — Rent to Own",
    address:"566 4th St, Floresville, TX",
    summary:"2005 • 1,792 sf • $75,000 or RTO with $5,000 down (12% for 8 yrs)",
    price:"$75,000",
    photos:[],
    links:{ pictures:"https://drive.google.com/drive/u/0/folders/1zryK15xf6vJNyzyrQNTOebOanhYK71zN" }
  },
  {
    id:"pinn-rd", group:"swift",
    title:"Affordable 3/2 Mobile Home — Move-In Ready",
    address:"1721 Pinn Rd LOT 48, San Antonio, TX 78227",
    summary:"2000 SW • DP $3,000 • $1,315/mo (incl. $625 lot rent) • A/C 2 yrs",
    price:"$45,000 (cash)",
    photos:[],
    links:{ pictures:"https://photos.app.goo.gl/JtB5rz7GMEtyrTyu6" }
  },
  {
    id:"corpus-2017", group:"swift",
    title:"2017 3/2 in Corpus (12 mins to JP Luby Beach)",
    address:"557 Crayton St, Corpus Christi, TX 78418",
    summary:"1,216 sf • Wind Zone II • Strong rental/owner-finance play",
    price:"$55,000 (cash)",
    photos:[],
    links:{
      pictures:"https://www.dropbox.com/scl/fo/r4ihvvdawmhjtbxqh1owt/APcUHqCzJdnNw6CYAYbFL5I?rlkey=g5lwbisnymstvhbceccx5i8v1&dl=0",
      craigslist:"https://corpuschristi.craigslist.org/reo/d/corpus-christi-2017-singlewide-bed-bath/7851895642.html"
    }
  },
  {
    id:"hondo-9ac", group:"swift",
    title:"4/3 Doublewide on 9.93 acres with Workshop",
    address:"370 County Road 347, Hondo, TX 78861",
    summary:"Palm Harbor (28x76) • 2 living rooms • workshop w/ bath & mini-split",
    price:"Ask $250,000 (ARV ≈ $350k)",
    photos:[],
    links:{ pictures:"https://drive.google.com/drive/folders/1nbb0CCTF9o2oO9MPC9mcjmaV9VSCDEha?usp=sharing" }
  },
  {
    id:"escondido-21010", group:"swift",
    title:"Big-Family Play — 4/2 DW + gutted 2/1 SW (combine to 6/3)",
    address:"21010 Escondido Park, San Antonio, TX 78264",
    summary:".6 acre corner • New roof/paint • Needs HVAC, MEP, septic, kitchens/baths",
    price:"$135,000 cash (RTO: $155k with $25k down @12%)",
    photos:[],
    links:{ pictures:"https://drive.google.com/drive/u/0/folders/15mvuzjF5FOrf8yUn8hyPVnmj18tuoK_u" }
  },
  {
    id:"escondido-21016", group:"swift",
    title:"4/3 Double-wide on 0.6 acres — Updated + NEW HVAC @ close",
    address:"21016 Escondido Park, San Antonio, TX 78264",
    summary:"1792 sf • new floors/paint/porches • tiled primary shower • office/flex",
    price:"$235,000 cash (RTO: $250k; $25k down; $2,385/mo)",
    photos:[],
    links:{ pictures:"https://drive.google.com/drive/folders/1f7BwOPbue3I0HF6Qn49Ws4arzXkI6_Ej" }
  },
  {
    id:"eveningway", group:"swift",
    title:"3/2 Brick — Handyman Special",
    address:"9923 Eveningway Dr, San Antonio, TX 78233",
    summary:"1486 sf • 0.23 ac • 1960 build",
    price:"$125,000 (ARV ≈ $203k; est. repairs $25k)",
    photos:[],
    links:{ pictures:"https://drive.google.com/drive/folders/1?pli=1" }
  },
  {
    id:"logswood", group:"swift",
    title:"3/2 near the FORUM — Great Rental",
    address:"109 Logswood, Universal City, TX 78148",
    summary:"1,353 sf • skylights • two living rooms • privacy fence",
    price:"$190,000 (OF: $230k @10%/25yr; $25k down)",
    photos:[],
    links:{}
  },
  {
    id:"baylor", group:"swift",
    title:"3/1 Near Lone Star District — Tear Down",
    address:"152 E Baylor St, San Antonio, TX 78204",
    summary:"960 sf • 5,500 sf lot • *Assignment of Contract*",
    price:"$55,000 cash",
    photos:[],
    links:{}
  }
];

/* =======================
   MAP + GEOCODING
======================= */
const map = L.map('map', {
  center:[29.47,-98.52], zoom:10, scrollWheelZoom:true, preferCanvas:true
});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap'
}).addTo(map);

// simple color icon
function colorIcon(color){
  return new L.DivIcon({
    className:'pin',
    html:`<div style="
      width:20px;height:20px;border-radius:50%;
      border:2px solid #fff;background:${color};
      box-shadow:0 2px 8px rgba(0,0,0,.45)"></div>`,
    iconSize:[20,20], iconAnchor:[10,10]
  });
}
const ICONS = {
  featured: colorIcon('#2b74ff'),
  swift:    colorIcon('#caa86a')
};

// polite geocoder with localStorage cache
async function geocode(addr){
  const key = 'geo:'+addr.toLowerCase();
  const cached = localStorage.getItem(key);
  if(cached){ return JSON.parse(cached); }
  await new Promise(r=>setTimeout(r, 250));
  const url = 'https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(addr);
  const res = await fetch(url, {headers:{'Accept':'application/json'}});
  const js  = await res.json();
  if(js && js[0]){
    const out = {lat:+js[0].lat, lon:+js[0].lon};
    localStorage.setItem(key, JSON.stringify(out));
    return out;
  }
  return null;
}

// render details card
function renderCard(d){
  const img = d.photos?.[0] || '';
  const el = document.createElement('article');
  el.className = 'card';
  el.id = 'deal-'+d.id;
  el.innerHTML = `
    ${img ? `<img class="thumb" src="${img}" alt="">` : `<div class="thumb"></div>`}
    <div class="pad">
      <div class="title">${d.title}</div>
      <div class="meta">${d.summary || ''}</div>
      ${d.price? `<div class="row"><span class="tag">Price: ${d.price}</span></div>`:''}
      <div class="row" style="margin-top:10px">
        <a class="btn primary" href="tel:+15128435181">I'm Interested</a>
        ${d.links?.pictures ? `<a class="btn" target="_blank" href="${d.links.pictures}">Pictures</a>`:''}
        ${d.links?.craigslist ? `<a class="btn" target="_blank" href="${d.links.craigslist}">Craigslist</a>`:''}
      </div>
      <div class="meta" style="margin-top:8px">📍 ${d.address}</div>
      <div class="meta">Type: ${d.group==='featured'?'Featured':'Swift Sell'}</div>
    </div>`;
  document.getElementById('cards').appendChild(el);
}

// popup “View details” + call button
function popupHTML(d){
  const img = d.photos?.[0] || '';
  return `
    <div style="min-width:220px;max-width:260px">
      ${img ? `<img src="${img}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:6px">` : ''}
      <div style="font-weight:800">${d.title}</div>
      <div style="color:#7fb0ff;font-size:12px;margin:2px 0">${d.summary || ''}</div>
      ${d.price ? `<div style="font-size:12px;margin:4px 0">Price: ${d.price}</div>`:''}
      <div style="display:flex;gap:8px;margin-top:8px">
        <a href="#deal-${d.id}" onclick="document.getElementById('deal-${d.id}').scrollIntoView({behavior:'smooth',block:'start'})"
           style="padding:6px 8px;border:1px solid #2a3a4e;border-radius:8px;background:#102433;color:#dff1ff;text-decoration:none;font-weight:700">View details</a>
        <a href="tel:+15128435181" style="padding:6px 8px;border:1px solid #2a3a4e;border-radius:8px;background:#0f2945;color:#dff1ff;text-decoration:none;font-weight:700">Call</a>
      </div>
    </div>`;
}

// boot
(async function init(){
  // cards first
  deals.forEach(renderCard);

  // place markers
  const bounds = L.latLngBounds([]);
  for(const d of deals){
    try{
      const g = await geocode(d.address);
      if(!g) continue;
      const m = L.marker([g.lat,g.lon], {icon:ICONS[d.group]}).addTo(map);
      m.bindPopup(popupHTML(d));
      bounds.extend([g.lat,g.lon]);
    }catch(_){}
  }
  if(bounds.isValid()){ map.fitBounds(bounds.pad(0.15)); }
})();
</script>
</body>
</html>
