<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DealBankers ‚Äî Sign In</title>
  <meta name="robots" content="noindex"/>
  <style>
    :root{
      --bg:#0b1218; --panel:#0f1a24ee; --glass:rgba(255,255,255,.06);
      --text:#e7eef4; --muted:#9fb3c7; --accent:#c7a86a; --line:rgba(255,255,255,.12);
      --ok:#2aa84a; --bad:#de3e3e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--text); background:radial-gradient(1000px 800px at 10% 0%, #14202b 0%, var(--bg) 40%, #071017 100%);
      display:grid; place-items:center; padding:24px;
    }
    .card{
      width:100%; max-width:460px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line); border-radius:22px; padding:28px; box-shadow:0 24px 64px rgba(0,0,0,.45);
      backdrop-filter: blur(8px);
    }
    .brand{display:flex; align-items:center; gap:12px; margin-bottom:14px}
    .brand .dot{width:12px; height:12px; border-radius:50%; background:var(--accent); box-shadow:0 0 24px var(--accent)}
    h1{margin:0; font-size:22px; letter-spacing:.2px}
    p{margin:6px 0 16px; color:var(--muted); font-size:14px}
    button{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--line); background:#162330;
      color:var(--text); font-weight:600; cursor:pointer; transition:transform .04s ease, border-color .2s ease, background .2s ease;
    }
    button:hover{transform:translateY(-1px); border-color:#2b96ff44}
    .row{display:flex; gap:12px}
    .row > button{flex:1}
    .sep{display:flex; align-items:center; gap:12px; margin:16px 0; color:var(--muted); font-size:12px}
    .sep:before,.sep:after{content:""; flex:1; height:1px; background:var(--line)}
    .tiny{font-size:12px; color:var(--muted)}
    .status{margin-top:14px; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.04); border:1px dashed var(--line); font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; max-height:160px; overflow:auto; white-space:pre-wrap}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .hint{margin-top:10px; font-size:12px; color:var(--muted)}
    a.link{color:#8ecaff; text-decoration:none}
    a.link:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="card">
    <div class="brand"><span class="dot"></span><h1>DealBankers ‚Äî Secure Sign-In</h1></div>
    <p>Use your Google account to access your portal.</p>

    <button id="googleBtn" type="button">Continue with Google</button>

    <div class="sep">or</div>

    <div class="row">
      <button id="redirectBtn" type="button" title="Use redirect flow (more reliable on locked-down browsers)">Use Redirect</button>
      <button id="signOutBtn" type="button">Sign out</button>
    </div>

    <div id="authState" class="hint">Auth: <span>checking‚Ä¶</span></div>
    <div id="originInfo" class="hint"></div>
    <div id="status" class="status" aria-live="polite"></div>

    <p class="tiny">If sign-in fails, verify your domain is in Firebase Auth ‚Üí Authorized domains and in your API key‚Äôs HTTP referrers.</p>
  </div>

  <!-- Firebase v10 (modular, CDN) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult,
      setPersistence, browserLocalPersistence, onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Keep your existing project settings (no API key printed anywhere)
    const firebaseConfig = {
      apiKey: "AIzaSyAoidTIHZZwOJ_FrXXMZd_hPAuoxDJJncs",
      authDomain: "deal-bankers.firebaseapp.com",
      projectId: "deal-bankers"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({ prompt: "select_account" });

    const statusEl = document.getElementById("status");
    const authStateEl = document.getElementById("authState").querySelector("span");
    const originInfo = document.getElementById("originInfo");
    originInfo.textContent = "Origin: " + window.location.origin;

    function log(msg, cls=""){
      const line = document.createElement("div");
      if (cls) line.className = cls;
      line.textContent = msg;
      statusEl.appendChild(line);
      statusEl.scrollTop = statusEl.scrollHeight;
      console.log(msg);
    }

    await setPersistence(auth, browserLocalPersistence);

    // Show redirect result if returning from the Google redirect flow
    try {
      const redir = await getRedirectResult(auth);
      if (redir?.user) {
        log("‚úÖ Redirect signed in: " + (redir.user.email || redir.user.uid), "ok");
        // Keep overview: no auto-redirect. If you ever want it:
        // window.location.href = "/acquisition.html";
      }
    } catch (e) {
      log("‚ùå Redirect error: " + e.code + " ‚Äî " + e.message, "bad");
    }

    onAuthStateChanged(auth, (user) => {
      authStateEl.textContent = user ? (user.email || user.uid) : "signed out";
    });

    async function loginPopup(){
      try {
        const res = await signInWithPopup(auth, provider);
        log("‚úÖ Popup signed in: " + (res.user.email || res.user.uid), "ok");
        // Keep overview: no auto-redirect.
        // window.location.href = "/acquisition.html";
      } catch (e) {
        log("‚ùå Popup sign-in failed: " + e.code + " ‚Äî " + e.message, "bad");
        const code = (e.code || "").toString();
        // Fall back where popup is unreliable
        if (
          code === "auth/popup-blocked" ||
          code === "auth/popup-closed-by-user" ||
          code.startsWith("auth/visibility") ||
          code === "auth/cors-unsupported" ||
          code === "auth/operation-not-supported-in-this-environment"
        ) {
          log("‚Ü™Ô∏è Using redirect flow instead‚Ä¶");
          return loginRedirect();
        }
      }
    }

    async function loginRedirect(){
      try {
        await signInWithRedirect(auth, provider);
      } catch (e) {
        log("‚ùå Redirect sign-in failed: " + e.code + " ‚Äî " + e.message, "bad");
      }
    }

    async function doSignOut(){
      try {
        await signOut(auth);
        log("üëã Signed out", "ok");
      } catch (e) {
        log("‚ùå Sign-out error: " + e.code + " ‚Äî " + e.message, "bad");
      }
    }

    document.getElementById("googleBtn").addEventListener("click", loginPopup);
    document.getElementById("redirectBtn").addEventListener("click", loginRedirect);
    document.getElementById("signOutBtn").addEventListener("click", doSignOut);
  </script>
</body>
</html>
