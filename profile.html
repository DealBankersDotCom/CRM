<!-- ======================== DealBankers • Profile (retro-noir, cleaned) ======================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DealBankers • Profile</title>
  <link rel="icon" type="image/jpeg" href="icon (1).jpg"/>
  <meta name="robots" content="noindex"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    :root{
      --bg:#0a0f16; --bg2:#0f1a24; --panel:#0f202e; --card:#0f1a24;
      --line:#1f3950; --text:#eaf2ff; --muted:#9bb6ca;
      --gold:#ffd36b; --neon:#52c8ff; --green:#26cf84; --r:18px;
      --shadow:0 22px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 560px at 90% -10%, rgba(82,200,255,.18) 0%, transparent 60%),
        linear-gradient(135deg,#090f16,#0d1823 55%,#112a3c);
      padding:14px;
    }
    .shell{max-width:1200px;margin:0 auto;border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow);
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03))}
    header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line)}
    .brand{display:flex;gap:10px;align-items:center}
    .brand img{width:40px;height:40px;border-radius:10px;object-fit:cover}
    .brand h1{margin:0;font-size:14px;letter-spacing:.16em;color:#cfe0f2}
    .pill{width:42px;height:42px;border-radius:50%;border:0;color:#fff;font-size:18px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}
    .pill.red{background:linear-gradient(180deg,#ff4040,#a40000)}
    .pill.blue{background:linear-gradient(180deg,#3ba6ff,#004aa9)}
    .btn{padding:8px 12px;border-radius:12px;border:1px solid var(--line);background:#0f1a24;color:#cfe2f3;cursor:pointer}
    .btn.gold{background:linear-gradient(180deg,var(--gold),#c89b3a);border:none;color:#231b08}
    .tabs{display:flex;gap:8px;padding:10px 12px 0;flex-wrap:wrap}
    .tab{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#0f1a24;color:#cde1f3;cursor:pointer}
    .tab.active{background:linear-gradient(180deg,#1a6c92,#0e435d);border-color:transparent;color:#ecfbff}
    .panel{padding:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:12px}

    .subtabs{display:flex;gap:8px;margin:0 0 10px}
    .subtab{padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:#0f1a24;color:#cde1f3;cursor:pointer}
    .subtab.active{background:linear-gradient(180deg,#ffd36b,#c89b3a);color:#1c1406;border:none}

    .iframe-wrap{border:1px solid var(--line);border-radius:var(--r);overflow:hidden;background:#0b141b;height:86vh;min-height:640px}
    .iframe-wrap iframe{width:100%;height:100%;border:0}

    /* Settings */
    .muted{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .input,.select,.textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #1b3245;background:#0c1620;color:#eaf1f6}
    .chk{display:flex;flex-wrap:wrap;gap:8px}
    .chip{padding:7px 11px;border-radius:999px;border:1px solid var(--line);background:#0d2130}
    .chip input{margin-right:6px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand"><img src="icon (1).jpg" alt="DealBankers"/><h1>DEALBANKERS • PROFILE</h1></div>
      <div class="hdr-actions">
        <button class="pill red"  title="Immediate Need">☎</button>
        <button class="pill blue" title="Standard Request">☎</button>
        <button id="logoutBtn" class="btn">Log Out</button>
      </div>
    </header>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="wholesaler">Wholesaler</button>
      <button class="tab" data-tab="contractor">Contractor</button>
      <button class="tab" data-tab="realtor">Realtor</button>
      <button class="tab" data-tab="investor">Investor</button>
      <button class="tab" data-tab="settings">Settings</button>
    </nav>

    <section class="panel">
      <!-- OVERVIEW -->
      <div class="card" data-panel="overview">
        <div class="muted">Townhall & notes coming here. (Trimmed for brevity)</div>
      </div>

      <!-- WHOLESALER -->
      <div class="card" data-panel="wholesaler" style="display:none">
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <div class="subtabs" id="whSubtabs">
            <button class="subtab active" data-sub="acq">Acquisition</button>
            <button class="subtab" data-sub="dispo">Dispo</button>
          </div>
          <div class="muted" style="margin-left:auto">Filters moved to <b>Settings → Wholesaler</b>.</div>
        </div>
        <div class="iframe-wrap"><iframe id="whFrame" title="Wholesaler Portal" loading="eager"></iframe></div>
      </div>

      <!-- CONTRACTOR / REALTOR / INVESTOR placeholders -->
      <div class="card" data-panel="contractor" style="display:none"><p class="muted" style="margin:0">Contractor portal is on its own screen (unchanged).</p></div>
      <div class="card" data-panel="realtor" style="display:none"><p class="muted" style="margin:0">Realtor tools coming soon.</p></div>
      <div class="card" data-panel="investor" style="display:none"><p class="muted" style="margin:0">Investor tools coming soon.</p></div>

      <!-- SETTINGS -->
      <div class="card" data-panel="settings" style="display:none">
        <h2 style="margin:0 0 10px">Settings</h2>

        <div class="card" style="margin-bottom:12px">
          <h3 style="margin:0 0 6px">Wholesaler Buy Box</h3>
          <div class="grid">
            <label>
              <div class="muted">ZIP filters (comma separated)</div>
              <input id="whZips" class="input" placeholder="e.g., 77003, 77004"/>
            </label>
            <label>
              <div class="muted">Require phone on file?</div>
              <select id="whHasPhone" class="select">
                <option value="">No preference</option>
                <option value="1">Yes, must have phone</option>
              </select>
            </label>
          </div>

          <div style="margin-top:10px">
            <div class="muted" style="margin-bottom:6px">Type</div>
            <div class="chk" id="whTypes">
              <label class="chip"><input type="checkbox" value="residential"/> Residential</label>
              <label class="chip"><input type="checkbox" value="commercial"/> Commercial</label>
              <label class="chip"><input type="checkbox" value="land"/> Land</label>
            </div>
          </div>

          <div style="margin-top:10px">
            <div class="muted" style="margin-bottom:6px">Strategy</div>
            <div class="chk" id="whStrats">
              <label class="chip"><input type="checkbox" value="flip"/> Flip</label>
              <label class="chip"><input type="checkbox" value="brrrr"/> BRRRR</label>
              <label class="chip"><input type="checkbox" value="buyhold"/> Buy & Hold</label>
              <label class="chip"><input type="checkbox" value="wholesale"/> Wholesale</label>
              <label class="chip"><input type="checkbox" value="sellerfinance"/> Seller Finance</label>
            </div>
          </div>

          <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
            <button id="saveWh" class="btn gold">Save Wholesaler Settings</button>
            <span id="saveNote" class="muted" style="display:none">Saved ✓</span>
          </div>
          <div class="muted" style="margin-top:8px">These feed the ACQ view and are stored under <code>userSettings/&lt;uid&gt;/wholesaler</code>.</div>
        </div>

        <!-- Other roles collapsed for brevity -->
        <div class="muted">Other role preferences unchanged.</div>
      </div>
    </section>
  </div>

  <footer style="max-width:1200px;margin:12px auto 6px;color:var(--muted);font-size:12px;display:flex;justify-content:space-between">
    <div>© 2025 DealBankers.com — All rights reserved.</div>
    <div>Profile v2.3</div>
  </footer>

  <!-- Firebase + Leaflet -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script>
    // Firebase
    const cfg={apiKey:"AIzaSyAoidTIHZZwOJ_FrXXMZd_hPAuoxDJJncs",authDomain:"deal-bankers.firebaseapp.com",projectId:"deal-bankers",databaseURL:"https://deal-bankers-default-rtdb.firebaseio.com"};
    firebase.initializeApp(cfg);
    const auth=firebase.auth(), db=firebase.database();
    const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));

    // Tabs
    const tabs=$$('.tab'), panels=$$('[data-panel]');
    function show(name){
      tabs.forEach(t=>t.classList.toggle('active',t.dataset.tab===name));
      panels.forEach(p=>p.style.display=(p.dataset.panel===name)?'block':'none');
      const u=new URL(location.href); u.searchParams.set('tab',name); history.replaceState(null,'',u);
      if(name==='wholesaler') ensureWhFrame();
    }
    $('#tabs').addEventListener('click',e=>{const b=e.target.closest('.tab'); if(!b) return; show(b.dataset.tab);});

    // ACQ/DISPO toggle (Profile is source of truth)
    let whSub=(new URL(location.href).searchParams.get('wh')==='dispo')?'dispo':'acq';
    $$('#whSubtabs .subtab').forEach(b=>{
      b.classList.toggle('active',b.dataset.sub===whSub);
      b.onclick=()=>{ whSub=b.dataset.sub; $$('#whSubtabs .subtab').forEach(x=>x.classList.toggle('active',x===b)); ensureWhFrame(); };
    });

    // Build embedded wholesaler URL (hide its own nav)
    function buildWhSrc(){
      const uid=encodeURIComponent(auth.currentUser?.uid||'anon');
      const qp=new URLSearchParams({embed:'1',sub:whSub,uid,ui:'embed'});
      return `wholesaler.html?${qp.toString()}`;
    }
    function ensureWhFrame(){ $('#whFrame').src = buildWhSrc(); }

    // Settings (Wholesaler)
    function readChecked(containerSel){
      return $$(containerSel+' input[type="checkbox"]:checked').map(cb=>cb.value);
    }
    function setChecked(containerSel, values){
      const set=new Set(values||[]); $$(containerSel+' input[type="checkbox"]').forEach(cb=>{ cb.checked=set.has(cb.value); });
    }
    async function loadWhSettings(uid){
      const snap=await db.ref(`userSettings/${uid}/wholesaler`).get().catch(()=>({val:()=>null}));
      const v=snap.val()||{};
      $('#whZips').value=(v.zips||[]).join(', ');
      $('#whHasPhone').value=v.hasPhone?'1':'';
      setChecked('#whTypes', v.types||[]);
      setChecked('#whStrats', v.strategies||[]);
    }
    async function saveWhSettings(uid){
      const z=($('#whZips').value||'').split(',').map(s=>s.trim()).filter(Boolean);
      const types=readChecked('#whTypes');
      const strategies=readChecked('#whStrats');
      const payload={zips:z, types, strategies, hasPhone:($('#whHasPhone').value==='1'), settingsVersion:firebase.database.ServerValue.TIMESTAMP, leadsEnabled:true};
      await db.ref(`userSettings/${uid}/wholesaler`).set(payload);
      $('#saveNote').style.display='inline'; setTimeout(()=>$('#saveNote').style.display='none',1200);
      // refresh embedded ACQ/DISPO with new filters
      ensureWhFrame();
    }

    // Boot
    auth.onAuthStateChanged(async u=>{
      if(!u){location.href='index.html';return;}
      const tab=(new URL(location.href).searchParams.get('tab'))||'overview';
      show(tab);
      await loadWhSettings(u.uid);
      $('#saveWh').onclick=()=>saveWhSettings(u.uid);
    });
    $('#logoutBtn').onclick=()=>auth.signOut().then(()=>location.href='index.html');
  </script>
</body>
</html>
