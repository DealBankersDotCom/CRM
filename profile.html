<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DealBankers • Profile</title>
<link rel="icon" type="image/jpeg" href="icon (1).jpg"/>
<meta name="robots" content="noindex"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  :root{--bg:#0d1620;--panel:#0f1a24;--line:#1b3245;--text:#eaf1f6;--muted:#9fb3c7;--blue:#2b74ff;--r:18px;--green:#26cf84;--card:#10222e;--gold:#ffd36b}
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;color:var(--text);
  background:radial-gradient(900px 500px at 90% -10%, #123043 0%, transparent 60%),linear-gradient(135deg,#0b1118,#0e1a24 55%,#10283a);min-height:100vh;padding:14px}
  .shell{max-width:1200px;margin:0 auto;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid var(--line);border-radius:20px;box-shadow:0 24px 64px rgba(0,0,0,.5)}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
  .brand{display:flex;gap:12px;align-items:center}.brand img{width:40px;height:40px;border-radius:10px;object-fit:cover}.brand h1{margin:0;font-size:14px;letter-spacing:.18em;color:#cfe0f2}
  .pill{width:44px;height:44px;border-radius:50%;border:none;display:inline-flex;align-items:center;justify-content:center;color:#fff;font-size:20px;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.35)}
  .pill.red{background:linear-gradient(180deg,#ff3b3b,#b30000)}.pill.blue{background:linear-gradient(180deg,#3b9eff,#0049b3)}
  .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:#0f1a24;color:#cfe2f3;cursor:pointer}
  .tabs{display:flex;gap:8px;padding:10px 12px 0;flex-wrap:wrap}.tab{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#0f1a24;color:#cde1f3;cursor:pointer}.tab.active{background:linear-gradient(180deg,var(--blue),#0a58ca);color:#fff;border:none}
  .panel{padding:12px}.card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:12px}
  .iframe-wrap{border:1px solid var(--line);border-radius:var(--r);overflow:hidden;background:#0b141b;height:85vh;min-height:620px}
  .iframe-wrap iframe{width:100%;height:100%;border:0}
  .overview-grid{display:grid;gap:12px;grid-template-columns:1.1fr 1.4fr}
  .portal-embed{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#0b141b;height:62vh;min-height:420px}
  .muted{color:#9fb3c7;font-size:13px}
  /* GLOBAL WHOLESALER FILTERS (over the panel) */
  .qf{display:flex;flex-wrap:wrap;gap:8px;padding:10px;border:1px solid var(--line);border-radius:12px;background:#0f1a24;margin:0 0 10px}
  .qf .tag{padding:6px 10px;border-radius:999px;border:1px solid #27465f;background:#0d2332;color:#cfe7ff;cursor:pointer}
  .qf .tag.on{background:#14577b;color:#fff;border-color:transparent}
  .qf .mini{width:160px;padding:8px 10px;border-radius:10px;border:1px solid #27465f;background:#0d2332;color:#eaf6ff}
  /* Contractor bits left as-is */
  #coMap{height:58vh;min-height:360px;border-radius:12px;border:1px solid var(--line);overflow:hidden}
</style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand"><img src="icon (1).jpg" alt="DealBankers"/><h1>DEALBANKERS • PROFILE</h1></div>
      <div><button class="pill red" title="Immediate Need">☎</button><button class="pill blue" title="Standard Request">☎</button><button id="logoutBtn" class="btn">Log Out</button></div>
    </header>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="wholesaler">Wholesaler</button>
      <button class="tab" data-tab="contractor">Contractor</button>
      <button class="tab" data-tab="realtor">Realtor</button>
      <button class="tab" data-tab="investor">Investor</button>
      <button class="tab" data-tab="settings">Settings</button>
    </nav>

    <section class="panel">
      <!-- OVERVIEW (unchanged, trimmed for brevity) -->
      <div class="card" data-panel="overview">
        <div class="overview-grid">
          <div class="portal-embed"><iframe id="whEmbed" title="Wholesaler (Overview Embed)"></iframe></div>
          <div class="card"><h3 style="margin:0">Townhall & Notes</h3><div id="thBody" class="muted">…</div></div>
        </div>
      </div>

      <!-- WHOLESALER -->
      <div class="card" data-panel="wholesaler" style="display:none">
        <div class="subtabs">
          <button class="subtab active" data-sub="acq">Acquisition</button>
          <button class="subtab" data-sub="dispo">Dispo</button>
        </div>

        <!-- GLOBAL quick filters live here (apply to both ACQ and DISPO in iframe) -->
        <div id="whFilterBar" class="qf">
          <span class="muted" style="align-self:center">Type:</span>
          <button class="tag" data-q="type" data-val="residential">Residential</button>
          <button class="tag" data-q="type" data-val="commercial">Commercial</button>
          <button class="tag" data-q="type" data-val="land">Land</button>

          <span class="muted" style="align-self:center;margin-left:8px">Strategy:</span>
          <button class="tag" data-q="strategy" data-val="flip">Flip</button>
          <button class="tag" data-q="strategy" data-val="brrrr">BRRRR</button>
          <button class="tag" data-q="strategy" data-val="buyhold">Buy & Hold</button>
          <button class="tag" data-q="strategy" data-val="wholesale">Wholesale</button>
          <button class="tag" data-q="strategy" data-val="sellerfinance">Seller Finance</button>

          <button class="tag" id="qHasPhone" data-q="hasphone" data-val="1" style="margin-left:8px">Has phone</button>
          <input id="qZips" class="mini" placeholder="ZIPs e.g. 77003,77004"/>
        </div>

        <div class="iframe-wrap"><iframe id="whFrame" title="Wholesaler Portal"></iframe></div>
      </div>

      <!-- CONTRACTOR / REALTOR / INVESTOR / SETTINGS (unchanged) -->
      <div class="card" data-panel="contractor" style="display:none"><div id="coMap"></div></div>
      <div class="card" data-panel="realtor" style="display:none"><p class="muted">Realtor tools coming soon.</p></div>
      <div class="card" data-panel="investor" style="display:none"><p class="muted">Investor portal coming soon.</p></div>
      <div class="card" data-panel="settings" style="display:none"><p class="muted">Long-term settings here; lead filters are above the Wholesaler panel.</p></div>
    </section>
  </div>
  <footer style="max-width:1200px;margin:14px auto 6px;color:#9fb3c7;font-size:12px;display:flex;justify-content:space-between"><div>© 2025 DealBankers.com</div><div>Profile v2.1</div></footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script>
    const cfg={apiKey:"AIzaSyAoidTIHZZwOJ_FrXXMZd_hPAuoxDJJncs",authDomain:"deal-bankers.firebaseapp.com",projectId:"deal-bankers",databaseURL:"https://deal-bankers-default-rtdb.firebaseio.com"};
    firebase.initializeApp(cfg); const auth=firebase.auth(); const db=firebase.database();
    const $=s=>document.querySelector(s);

    // Tab wiring
    const tabs=[...document.querySelectorAll('.tab')], panels=[...document.querySelectorAll('[data-panel]')];
    function show(name){ tabs.forEach(t=>t.classList.toggle('active',t.dataset.tab===name)); panels.forEach(p=>p.style.display=(p.dataset.panel===name)?'block':'none'); if(name==='wholesaler') ensureWh(); if(name==='overview') ensureOverview(); }
    $('#tabs').addEventListener('click',e=>{ const b=e.target.closest('.tab'); if(!b) return; show(b.dataset.tab); });

    // Sub-tabs (ACQ/DISPO)
    let whSub='acq'; document.querySelectorAll('.subtab').forEach(b=>b.addEventListener('click',()=>{ document.querySelectorAll('.subtab').forEach(x=>x.classList.toggle('active',x===b)); whSub=b.dataset.sub; loadWhIframes(); sendFilters(); }));

    // Session quick-filters (global over whole Wholesaler panel)
    const qf={types:new Set(), strategies:new Set(), hasPhone:false, zips:[]};
    $('#whFilterBar').addEventListener('click',e=>{
      const t=e.target.closest('.tag'); if(!t) return;
      const q=t.dataset.q, val=(t.dataset.val||'').toLowerCase();
      if(q==='type'){ t.classList.toggle('on'); t.classList.contains('on')?qf.types.add(val):qf.types.delete(val); }
      else if(q==='strategy'){ t.classList.toggle('on'); t.classList.contains('on')?qf.strategies.add(val):qf.strategies.delete(val); }
      else if(q==='hasphone'){ qf.hasPhone=!qf.hasPhone; t.classList.toggle('on', qf.hasPhone); }
      sendFilters();
    });
    $('#qZips').addEventListener('change',()=>{ qf.zips=($('#qZips').value||'').split(',').map(s=>s.trim()).filter(Boolean); sendFilters(); });

    function qfParams(){
      const o={}; if(qf.types.size) o.qfTypes=[...qf.types].join(',');
      if(qf.strategies.size) o.qfStrategies=[...qf.strategies].join(',');
      if(qf.hasPhone) o.qfHasPhone='1';
      if(qf.zips.length) o.qfZips=qf.zips.join(',');
      return o;
    }

    function buildWhSrc(sub){
      const u=new URLSearchParams({
        uid:auth.currentUser?.uid||'anon',
        email:auth.currentUser?.email||'',
        sub, embed:'1', ui:'desktop', leads:'1', // force lead access on
        ...qfParams()
      });
      return `wholesaler.html?${u.toString()}`;
    }

    function loadWhIframes(){
      const src=buildWhSrc(whSub);
      const srcAcq=buildWhSrc('acq');
      $('#whFrame').src=src;
      $('#whEmbed').src=srcAcq;
    }

    function sendFilters(){
      const payload={type:'whFilters', payload:{types:[...qf.types], strategies:[...qf.strategies], hasPhone:qf.hasPhone, zips:qf.zips}};
      try{$('#whFrame').contentWindow.postMessage(payload,'*');}catch{}
      try{$('#whEmbed').contentWindow.postMessage(payload,'*');}catch{}
    }

    function ensureWh(){ if(!$('#whFrame').src) loadWhIframes(); }
    function ensureOverview(){ if(!$('#whEmbed').src) loadWhIframes(); }

    auth.onAuthStateChanged(u=>{ if(!u){location.href='index.html';return;} loadWhIframes(); setTimeout(sendFilters,600); });
    document.getElementById('logoutBtn').onclick=()=>auth.signOut().then(()=>location.href='index.html');
  </script>
</body>
</html>
