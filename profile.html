<!-- ======================== DealBankers ‚Ä¢ Profile (Overview + Townhall + Settings + Wholesaler embed) ======================== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DealBankers ‚Ä¢ Profile</title>
<link rel="icon" type="image/jpeg" href="icon (1).jpg"/>
<meta name="robots" content="noindex"/>

<style>
:root{
  --bg:#0d1620; --panel:#0f1a24; --line:#1b3245;
  --text:#eaf1f6; --muted:#9fb3c7; --blue:#2b74ff;
  --r:18px; --shadow:0 24px 64px rgba(0,0,0,.5);
  --red:#ff5a5a; --cyan:#47b4ff; --green:#26cf84; --gold:#ffd36b;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
  color:var(--text);
  background:
    radial-gradient(900px 500px at 90% -10%, #123043 0%, transparent 60%),
    linear-gradient(135deg,#0b1118,#0e1a24 55%,#10283a);
  min-height:100vh; padding:14px;
}
.shell{max-width:1200px;margin:0 auto;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
  border:1px solid var(--line); border-radius:20px; box-shadow:var(--shadow)}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
.brand{display:flex;gap:12px;align-items:center}
.brand img{width:40px;height:40px;border-radius:10px;object-fit:cover}
.brand h1{margin:0;font-size:14px;letter-spacing:.18em;color:#cfe0f2}

.hdr-actions{display:flex;gap:10px;align-items:center}
.pill{width:44px;height:44px;border-radius:50%;border:none;display:inline-flex;align-items:center;justify-content:center;color:#fff;font-size:20px;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,.35)}
.pill.red{background:linear-gradient(180deg,#ff3b3b,#b30000)}
.pill.blue{background:linear-gradient(180deg,#3b9eff,#0049b3)}
.btn{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:#0f1a24;color:#cfe2f3;cursor:pointer}

.tabs{display:flex;gap:8px;padding:10px 12px 0;flex-wrap:wrap}
.tab{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#0f1a24;color:#cde1f3;cursor:pointer}
.tab.active{background:linear-gradient(180deg,var(--blue),#0a58ca);color:#fff;border:none}
.panel{padding:12px}
.card{background:#10222e;border:1px solid var(--line);border-radius:var(--r);padding:12px}

.grid2{display:grid;gap:12px;grid-template-columns:1.05fr 1.35fr}
.announce{border:1px solid var(--line);border-radius:14px;background:#0f1a24;padding:12px}
.portal-mini{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#0b141b}
.portal-mini iframe{width:100%;height:420px;border:0}

.townhall{display:grid;grid-template-rows:auto 1fr auto; gap:10px; height:62vh; min-height:420px}
.th-head{display:flex;align-items:center;justify-content:space-between}
.th-head h2{margin:0;font-size:18px;letter-spacing:.05em}
.presence{font-size:12px;color:#9fb3c7}
.th-body{border:1px solid var(--line);border-radius:14px;background:#0f1a24;overflow:auto;padding:12px}
.msg{margin:8px 0;display:grid;gap:4px}
.meta{font-size:11px;color:#a7bed0}
.bubble{display:inline-block;max-width:min(680px,85%);padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#142332}
.me .bubble{background:linear-gradient(180deg,#143a2a,#0d291f);border-color:rgba(69,255,169,.25)}
.th-input{display:flex;gap:8px}
.th-input input{flex:1;border:1px solid var(--line);border-radius:12px;padding:12px;background:#0f1a24;color:#eaf1f6}
.th-input button{min-width:96px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg,var(--green),#1a9b61);color:#fff;cursor:pointer}

.info-note{padding:10px 12px;margin:8px 0;border-radius:12px;border:1px dashed var(--line);color:#bcd0e3;background:#0e1b25}

.settings-grid{display:grid;gap:10px;grid-template-columns:1fr 1fr}
.box{background:#0f1a24;border:1px solid var(--line);border-radius:12px;padding:12px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.chip{padding:7px 11px;border-radius:999px;border:1px solid var(--line);background:#0b1a25;cursor:pointer}
.chip.active{background:linear-gradient(180deg,#173a57,#0b1e2c);border-color:#2f5673}
.input, .textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #1d3142;background:#0c1620;color:#eaf1f6}
.textarea{min-height:110px;resize:vertical}
.save{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:linear-gradient(180deg,var(--green),#1a9b61);color:#fff;cursor:pointer}

@media (max-width:980px){ .grid2{grid-template-columns:1fr} .townhall{height:58vh;min-height:380px} .portal-mini iframe{height:380px} }
</style>
</head>
<body>
<div class="shell">
  <header>
    <div class="brand">
      <img src="icon (1).jpg" alt="DealBankers"/>
      <h1>DEALBANKERS ‚Ä¢ PROFILE</h1>
    </div>
    <div class="hdr-actions">
      <button class="pill red"  id="redPhoneBtn"  title="Immediate Need">‚òé</button>
      <button class="pill blue" id="bluePhoneBtn" title="Standard Request">‚òé</button>
      <button id="logoutBtn" class="btn">Log Out</button>
    </div>
  </header>

  <nav class="tabs" id="tabs">
    <button class="tab active" data-tab="overview">Overview</button>
    <button class="tab" data-tab="wholesaler">Wholesaler</button>
    <button class="tab" data-tab="contractor">Contractor</button>
    <button class="tab" data-tab="realtor">Realtor</button>
    <button class="tab" data-tab="investor">Investor</button>
    <button class="tab" data-tab="settings">Settings</button>
  </nav>

  <section class="panel">
    <!-- OVERVIEW -->
    <div class="card" data-panel="overview">
      <div class="grid2">
        <div>
          <div class="announce">
            <h3 style="margin:0 0 6px">üì¢ Special Announcements</h3>
            <div id="meLine" class="info-note"></div>
            <div style="margin:8px 0 12px">
              <ul style="margin:0 0 10px 18px">
                <li>Welcome to the Townhall. Be respectful, be helpful.</li>
                <li>New: Street View + üöó Directions inside the wholesaler portal.</li>
              </ul>
            </div>

            <h3 style="margin:10px 0 6px">Active Offerings</h3>
            <div style="font-size:14px;line-height:1.45">
              Virgin D6 Lift ‚Äî FOB Houston ‚Ä¢ Capital Need: $300k ‚Ä¢ 7‚Äì10 days ‚Ä¢ 100M gal
              <div style="margin-top:4px">
                <a href="offering-memo2.html" target="_blank">Open Memo 2</a> ‚Ä¢
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdPp0mVxH5xHj8Zxvy5mrolw/viewform" target="_blank">Submit Interest</a>
              </div>
            </div>

            <h4 style="margin:12px 0 6px">Statement of Facts (Inline Preview)</h4>
            <div class="portal-mini">
              <!-- If your doc blocks embedding, this shows a fallback message -->
              <iframe id="factsFrame" src="offering-memo2.html" title="Statement of Facts"></iframe>
            </div>
          </div>

          <div class="portal-mini" style="margin-top:12px">
            <!-- mini wholesaler inside Overview (respects gate) -->
            <div id="miniWrap" class="info-note">Loading Wholesaler preview‚Ä¶</div>
            <iframe id="miniWh" style="display:none" title="Wholesaler Preview"></iframe>
          </div>
        </div>

        <div class="townhall">
          <div class="th-head">
            <h2>üèõÔ∏è Townhall (All Users)</h2>
            <div class="presence" id="presence">Connecting‚Ä¶</div>
          </div>
          <div class="th-body" id="thBody" aria-live="polite"></div>
          <div class="th-input">
            <input id="thInput" type="text" placeholder="Say something to the room‚Ä¶ (press Enter to send)"/>
            <button id="thSend">Send</button>
          </div>
        </div>
      </div>
    </div>

    <!-- WHOLESALER TAB -->
    <div class="card" data-panel="wholesaler" style="display:none">
      <div class="info-note">Lead filters live in <b>Settings ‚Üí Wholesaler</b>. No self-enable switch is shown here.</div>
      <div class="portal-mini" style="height:auto">
        <iframe id="whFrame" style="height:72vh;min-height:560px" title="Wholesaler Portal"></iframe>
      </div>
    </div>

    <!-- CONTRACTOR / REALTOR / INVESTOR -->
    <div class="card" data-panel="contractor" style="display:none"><p style="margin:0;color:#9fb3c7">Contractor portal coming soon.</p></div>
    <div class="card" data-panel="realtor" style="display:none"><p style="margin:0;color:#9fb3c7">Realtor portal coming soon.</p></div>
    <div class="card" data-panel="investor" style="display:none"><p style="margin:0;color:#9fb3c7">Investor portal coming soon.</p></div>

    <!-- SETTINGS -->
    <div class="card" data-panel="settings" style="display:none">
      <h3 style="margin:0 0 8px">Settings</h3>
      <div class="settings-grid">
        <div class="box">
          <h4 style="margin:0 0 6px">Wholesaler ‚Ä¢ Filters</h4>
          <div class="row" id="typeRow">
            <span class="chip" data-type="res">Residential</span>
            <span class="chip" data-type="com">Commercial</span>
            <span class="chip" data-type="land">Land</span>
          </div>
          <div class="row" id="stratRow" style="margin-top:8px">
            <span class="chip" data-strat="Flip">Flip</span>
            <span class="chip" data-strat="BRRRR">BRRRR</span>
            <span class="chip" data-strat="Buy & Hold">Buy & Hold</span>
            <span class="chip" data-strat="Wholesale">Wholesale</span>
            <span class="chip" data-strat="Seller Finance">Seller Finance</span>
          </div>
          <div style="margin-top:8px">
            <label>ZIPs (comma separated)</label>
            <input class="input" id="zipInput" placeholder="77003,77004,78207"/>
          </div>
          <div style="margin-top:8px">
            <label><input id="hasPhoneOnly" type="checkbox"/> Only show leads with a phone</label>
          </div>
          <button class="save" id="saveWh">Save Wholesaler Filters</button>
        </div>

        <div class="box">
          <h4 style="margin:0 0 6px">Call / Text Preference</h4>
          <div class="row" id="dialRow">
            <span class="chip" data-dial="device">Device (tel:)</span>
            <span class="chip" data-dial="textnow">TextNow</span>
            <span class="chip" data-dial="gvoice">Google Voice</span>
          </div>
          <div class="info-note" style="margin-top:10px">
            These preferences are used by the Wholesaler portal for üìû Call / üí¨ Text buttons.
          </div>
          <button class="save" id="saveDial">Save Dial Preference</button>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- REQUESTS MODAL (red/blue phones open this) -->
<div id="reqModal" class="modal" aria-hidden="true" role="dialog" aria-label="Send a request" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:60">
  <div class="backdrop" data-close style="position:absolute;inset:0;background:rgba(0,0,0,.6)"></div>
  <div class="sheet" style="position:relative;width:min(720px,94vw);max-height:86vh;overflow:auto;background:#0f1a24;border:1px solid var(--line);border-radius:16px;padding:16px">
    <button class="close" data-close style="position:absolute;right:12px;top:12px;border:0;background:#182632;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer">Close</button>
    <h2 style="margin-top:4px">Send a Request</h2>
    <p style="color:#9fb3c7">Tell us what you need. We‚Äôll follow up fast.</p>
    <form id="reqForm">
      <div class="settings-grid">
        <label><div class="muted">Request Type</div>
          <select class="input" id="reqType" required>
            <option value="Immediate Need">Immediate Need</option>
            <option value="Funding">Funding</option>
            <option value="Sell a Property">Sell a Property</option>
            <option value="Partner with Us">Partner with Us</option>
            <option value="Contractor Services">Contractor Services</option>
            <option value="Support / Bug">Support / Bug</option>
            <option value="Other">Other</option>
          </select>
        </label>
        <label><div class="muted">Preferred Contact</div>
          <input class="input" id="reqContact" placeholder="Phone, email, or TextNow handle"/>
        </label>
      </div>
      <label style="display:block;margin-top:10px"><div class="muted">Subject</div>
        <input class="input" id="reqSubject" placeholder="Short subject (optional)"/>
      </label>
      <label style="display:block;margin-top:10px"><div class="muted">Message</div>
        <textarea class="textarea" id="reqMessage" placeholder="What‚Äôs up? Add property address or details if relevant." required></textarea>
      </label>
      <div class="muted" style="margin-top:6px">We‚Äôll attach your account info automatically (name, email, uid).</div>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button type="submit" class="btn" style="background:linear-gradient(180deg,#3b9eff,#0049b3);border:none">Send Request</button>
        <a id="mailtoFallback" class="btn" href="#">Email Instead</a>
      </div>
    </form>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyAoidTIHZZwOJ_FrXXMZd_hPAuoxDJJncs",authDomain:"deal-bankers.firebaseapp.com",projectId:"deal-bankers",databaseURL:"https://deal-bankers-default-rtdb.firebaseio.com"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

const $=s=>document.querySelector(s);
const tabs=[...document.querySelectorAll('.tab')];
const panels=[...document.querySelectorAll('[data-panel]')];
let allowLeads=false, userEmail='', userUID='';

function show(name){
  tabs.forEach(t=>t.classList.toggle('active',t.dataset.tab===name));
  panels.forEach(p=>p.style.display=(p.dataset.panel===name)?'block':'none');
  const url=new URL(location.href); url.searchParams.set('tab',name); history.replaceState(null,'',url);
  if(name==='wholesaler') ensureWhIframe();
  if(name==='overview') ensureOverviewReady();
}

$('#tabs').addEventListener('click',e=>{
  const b=e.target.closest('.tab'); if(!b) return; show(b.dataset.tab);
});

/* Wholesaler iframes (main + mini) */
let whMainSet=false, whMiniSet=false;
function ensureWhIframe(){
  if(whMainSet) return; whMainSet=true;
  const uid=encodeURIComponent(auth.currentUser?.uid||'anon');
  $('#whFrame').src=`wholesaler.html?uid=${uid}`;
}
function ensureMini(){
  if(whMiniSet) return; whMiniSet=true;
  const uid=encodeURIComponent(auth.currentUser?.uid||'anon');
  const miniWrap=$('#miniWrap'), mini=$('#miniWh');
  if(!allowLeads){ miniWrap.textContent='Leads are disabled for this account.'; return; }
  mini.src=`wholesaler.html?uid=${uid}&mode=acq`;
  mini.style.display='block'; miniWrap.style.display='none';
}

/* Overview: Townhall + mini wholesaler */
let thReady=false;
function ensureOverviewReady(){
  ensureMini();
  if(thReady) return; thReady=true;

  const body=$('#thBody'), input=$('#thInput'), send=$('#thSend');
  function scrollBottom(){ body.scrollTop=body.scrollHeight; }

  db.ref('townhall/messages').limitToLast(100).on('child_added',snap=>{
    const m=snap.val(); if(!m) return;
    const me=auth.currentUser?.uid===m.uid;
    const div=document.createElement('div'); div.className='msg'+(me?' me':'');
    const meta=document.createElement('div'); meta.className='meta';
    const name=(m.name||'Someone'); const t=new Date(m.ts||Date.now());
    const hh=String(t.getHours()).padStart(2,'0'), mm=String(t.getMinutes()).padStart(2,'0');
    meta.textContent=`${name} ‚Ä¢ ${hh}:${mm}`;
    const bubble=document.createElement('div'); bubble.className='bubble'; bubble.textContent=m.text||'';
    div.append(meta,bubble); body.appendChild(div); scrollBottom();
  });

  const presenceRef=db.ref('townhall/presence');
  const myRef=presenceRef.push();
  db.ref('.info/connected').on('value',snap=>{
    if(snap.val()===true){
      myRef.onDisconnect().remove();
      myRef.set({uid:auth.currentUser?.uid||'anon', ts:firebase.database.ServerValue.TIMESTAMP});
    }
  });
  presenceRef.on('value',snap=>{
    $('#presence').textContent = `${snap.numChildren()} online`;
  });

  function sendMsg(){
    const txt=(input.value||'').trim(); if(!txt) return;
    const u=auth.currentUser||{};
    db.ref('townhall/messages').push({
      uid: u.uid || 'anon',
      name: u.displayName || u.email || 'Anon',
      text: txt,
      ts: firebase.database.ServerValue.TIMESTAMP
    });
    input.value=''; input.focus();
  }
  input.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); sendMsg(); }});
  send.addEventListener('click',sendMsg);
}

/* Settings UI helpers */
function hydrateChips(rowSel, values, attr){
  document.querySelectorAll(rowSel+' .chip').forEach(ch=>{
    const v = ch.getAttribute(attr);
    ch.classList.toggle('active', values?.includes(v));
    ch.onclick=()=>{ ch.classList.toggle('active'); };
  });
}
function readChips(rowSel, attr){
  return [...document.querySelectorAll(rowSel+' .chip.active')].map(ch=>ch.getAttribute(attr));
}

/* Requests modal */
const reqModal = document.getElementById('reqModal');
const openReq  = ()=>{ reqModal.style.display='flex'; reqModal.setAttribute('aria-hidden','false'); };
const closeReq = ()=>{ reqModal.style.display='none'; reqModal.setAttribute('aria-hidden','true'); };
reqModal.addEventListener('click', e=>{ if (e.target.hasAttribute('data-close')) closeReq(); });
document.getElementById('redPhoneBtn').onclick  = ()=>{ document.getElementById('reqType').value='Immediate Need'; openReq(); };
document.getElementById('bluePhoneBtn').onclick = ()=>{ document.getElementById('reqType').value='Funding'; openReq(); };
document.getElementById('reqForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const u=auth.currentUser; if(!u) return alert('Please sign in again');
  const payload={
    uid:u.uid, email:u.email||'', name:u.displayName||'',
    type: reqType.value, contact: reqContact.value.trim(),
    subject: reqSubject.value.trim(), message: reqMessage.value.trim(),
    status:'new', ts: Date.now()
  };
  if(!payload.message){ return alert('Please add a message'); }
  try{ await db.ref('requests').push(payload); closeReq(); alert('Request sent'); }
  catch(err){ console.error(err); alert('Could not send. Try again.'); }
});

/* Auth + gate + settings */
auth.onAuthStateChanged(async u=>{
  if(!u){ location.href='index.html'; return; }
  userEmail = u.email||''; userUID = u.uid;
  document.getElementById('meLine').textContent = `${u.email||''} ‚Äî UID: ${u.uid}`;

  const addr = encodeURIComponent('support@dealbankers.com');
  const subj = encodeURIComponent('DealBankers Request');
  const body = encodeURIComponent(`From: ${u.displayName||''} <${u.email||''}>\n\nDescribe your request here...`);
  document.getElementById('mailtoFallback').href = `mailto:${addr}?subject=${subj}&body=${body}`;

  // Leads gate (admin/owner always on)
  const owner = 'aptbhidsonline@gmail.com';
  if((u.email||'').toLowerCase()===owner) { allowLeads=true; }
  else {
    const snap = await db.ref(`userSettings/${u.uid}/wholesaler/leadsEnabled`).get();
    allowLeads = !!snap.val();
  }

  // set initial tab from URL
  const initial = new URL(location.href).searchParams.get('tab') || 'overview';
  show(initial);

  // Load saved settings into UI
  const s = (await db.ref(`userSettings/${u.uid}/wholesaler`).get()).val() || {};
  const filt = s.filters || {};
  hydrateChips('#typeRow',  filt.types || [],  'data-type');
  hydrateChips('#stratRow', filt.strats || [], 'data-strat');
  document.getElementById('zipInput').value = filt.zips || '';
  document.getElementById('hasPhoneOnly').checked = !!filt.hasPhoneOnly;

  hydrateChips('#dialRow', [s.dialMode || 'device'], 'data-dial');

  // if in Overview, prep mini embed
  ensureOverviewReady();
});

document.getElementById('saveWh').onclick = async ()=>{
  const types = readChips('#typeRow','data-type');
  const strats= readChips('#stratRow','data-strat');
  const zips  = document.getElementById('zipInput').value.trim();
  const hasPhoneOnly = document.getElementById('hasPhoneOnly').checked;
  await db.ref(`userSettings/${userUID}/wholesaler/filters`).set({types,strats,zips,hasPhoneOnly});
  alert('Wholesaler filters saved.');
};
document.getElementById('saveDial').onclick = async ()=>{
  const dial = readChips('#dialRow','data-dial')[0] || 'device';
  await db.ref(`userSettings/${userUID}/wholesaler/dialMode`).set(dial);
  alert('Dial preference saved.');
};

/* mini + main iframes */
function ensureWhIframe(){ if($('#whFrame').src) return; $('#whFrame').src=`wholesaler.html?uid=${encodeURIComponent(userUID)}`; }
function ensureMini(){ if($('#miniWh').src) return; if(allowLeads){ $('#miniWh').src=`wholesaler.html?uid=${encodeURIComponent(userUID)}&mode=acq`; $('#miniWh').style.display='block'; $('#miniWrap').style.display='none'; } else { $('#miniWrap').textContent='Leads are disabled for this account.'; } }

/* logout */
document.getElementById('logoutBtn').onclick=()=>auth.signOut().then(()=>location.href='index.html');
</script>
</body>
</html>
