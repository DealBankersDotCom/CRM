<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DealBankers • Profile</title>
<link rel="icon" type="image/jpeg" href="icon (1).jpg"/>

<style>
  :root{
    --bg:#0d1822; --panel:#0f1a24; --card:#12202d; --line:#203241;
    --text:#eaf1f6; --muted:#9fb3c7; --accent:#0d6efd; --gold:#c7a86a;
    --danger:#d9534f; --shadow:0 24px 64px rgba(0,0,0,.5);
    --r:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;
    background:
      radial-gradient(900px 500px at 85% -10%, #133243 0%, transparent 60%),
      linear-gradient(135deg,#0b1218,#0e1a24 50%,#102434);
    color:var(--text); min-height:100vh; padding:18px;
  }

  .shell{
    max-width:1200px; margin:0 auto;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid #1a2a36; border-radius:20px; box-shadow:var(--shadow); backdrop-filter:blur(12px);
  }
  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px; border-bottom:1px solid #1a2a36;
  }
  .brand{display:flex; gap:12px; align-items:center}
  .brand img{width:42px;height:42px;border-radius:10px;object-fit:cover;box-shadow:0 8px 20px rgba(0,0,0,.35)}
  .brand h1{font-size:16px; letter-spacing:.14em; text-transform:uppercase; margin:0; color:#bcd0e3}
  .row-actions{display:flex; gap:10px}
  .btn{
    padding:10px 14px; border-radius:10px; border:1px solid #264054; background:#10202c; color:var(--text);
    cursor:pointer; font-weight:600;
  }
  .btn:hover{filter:brightness(1.05)}
  .btn-danger{background:linear-gradient(180deg,#dd6060,#bb3e3e); border:none}

  /* Top tabs */
  .tabs{display:flex; gap:8px; padding:12px 12px 0; flex-wrap:wrap}
  .tab{
    padding:10px 14px; border-radius:999px; border:1px solid #1d3142; cursor:pointer;
    font-size:14px; background:#0f1a24; color:#bcd0e3;
  }
  .tab.active{background:linear-gradient(180deg,var(--accent),#0a58ca); color:#fff; border:none}

  .content{padding:16px; display:grid; gap:16px}
  .card{background:#10202c; border:1px solid #1a2a36; border-radius:var(--r); padding:16px}
  h2{margin:0 0 8px}
  .muted{color:var(--muted); font-size:13px}

  /* Secondary tabs (inside Wholesaler) */
  .subtabs{display:flex; gap:8px; margin:6px 0 12px; flex-wrap:wrap}
  .subtab{
    padding:8px 12px; border-radius:999px; border:1px solid #1d3142; cursor:pointer;
    background:#0f1a24; color:#cfe2f3; font-size:13px
  }
  .subtab.active{background:linear-gradient(180deg,var(--gold),#9d7d49); color:#111; border:none}

  /* Toolbar */
  .toolbar{display:flex; gap:8px; margin:0 0 10px; flex-wrap:wrap}
  .toolbtn{
    padding:8px 12px; border-radius:10px; border:1px solid #1d3142; background:#0f1a24; color:#cfe2f3; cursor:pointer;
    font-size:14px
  }
  .toolbtn:hover{filter:brightness(1.06)}

  /* iframe area */
  .iframe-wrap{
    border:1px solid #1a2a36; border-radius:var(--r); overflow:hidden; background:#0b141b;
    height:78vh; min-height:560px;
  }
  .iframe-wrap iframe{width:100%; height:100%; border:0; background:#fff}

  /* Responsive */
  @media (max-width:900px){
    .tabs{gap:6px}
    .iframe-wrap{height:86vh; min-height:640px}
  }
  @media (max-width:600px){
    body{padding:10px}
    header{padding:12px}
    .tabs{padding:10px 10px 0}
    .content{padding:12px}
    .card{padding:12px}
    .toolbtn{flex:1 1 150px; text-align:center}
    .iframe-wrap{height:88vh; min-height:680px}
  }
</style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand">
        <img src="icon (1).jpg" alt="DealBankers"/>
        <div><h1>DEALBANKERS • PROFILE</h1></div>
      </div>
      <div class="row-actions">
        <button id="logoutBtn" class="btn btn-danger">Log Out</button>
      </div>
    </header>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="wholesaler">Wholesaler</button>
      <button class="tab" data-tab="contractor">Contractor</button>
      <button class="tab" data-tab="realtor">Realtor</button>
      <button class="tab" data-tab="investor">Investor</button>
      <button class="tab" data-tab="settings">Settings</button>
    </nav>

    <section class="content">
      <!-- OVERVIEW -->
      <div class="card" data-panel="overview">
        <h2>Welcome</h2>
        <p class="muted">Select a portal above to get to work. Your profile supports multiple roles; enable and configure what you need.</p>
      </div>

      <!-- WHOLESALER -->
      <div class="card" data-panel="wholesaler" style="display:none">
        <h2>Wholesaler Workspace</h2>
        <div class="muted">Acquisition and Disposition tools live side-by-side. Use the sub-tabs to switch.</div>

        <div class="subtabs" id="whSubtabs">
          <button class="subtab active" data-sub="acq">Acquisition</button>
          <button class="subtab" data-sub="dispo">Dispo</button>
        </div>

        <!-- Acquisition block -->
        <div data-subpanel="acq">
          <div class="toolbar">
            <button class="toolbtn" id="btnNewTabWh">Open Fullscreen in New Tab</button>
            <button class="toolbtn" id="btnReloadWh">Reload Portal</button>
          </div>
          <div class="iframe-wrap" id="whWrap">
            <iframe src="" id="whFrame" title="Wholesaler Acquisition"></iframe>
          </div>
        </div>

        <!-- Dispo block -->
        <div data-subpanel="dispo" style="display:none">
          <div class="toolbar">
            <button class="toolbtn" id="btnAddDeal">Add Deal</button>
            <button class="toolbtn" id="btnSharePacket">Share Investor Packet</button>
            <button class="toolbtn" id="btnInvestorRoom">Open Investor Room</button>
            <button class="toolbtn" id="btnNewTabDi">Open Fullscreen in New Tab</button>
            <button class="toolbtn" id="btnReloadDi">Reload Portal</button>
          </div>
          <div class="iframe-wrap" id="diWrap">
            <iframe src="" id="diFrame" title="Dispositions Portal"></iframe>
          </div>

          <div class="toolbar" style="margin-top:10px">
            <button class="toolbtn" onclick="window.open('offer_packet.html','_blank')">Preview • Offering Memorandum</button>
            <button class="toolbtn" onclick="window.open('investor_signup.html','_blank')">Preview • Investor Signup</button>
            <button class="toolbtn" onclick="window.open('market_listing.html','_blank')">Preview • Public Listing</button>
          </div>
        </div>
      </div>

      <!-- CONTRACTOR -->
      <div class="card" data-panel="contractor" style="display:none">
        <h2>Contractor</h2>
        <p class="muted">Set your divisions (CSI MasterFormat) and service areas here. Coming soon.</p>
      </div>

      <!-- REALTOR -->
      <div class="card" data-panel="realtor" style="display:none">
        <h2>Realtor</h2>
        <p class="muted">MLS preferences, buyer/seller funnels, and referral routing. Coming soon.</p>
      </div>

      <!-- INVESTOR -->
      <div class="card" data-panel="investor" style="display:none">
        <h2>Investor</h2>
        <p class="muted">Buy box, return targets, preferred markets & dispositions. Coming soon.</p>
      </div>

      <!-- SETTINGS -->
      <div class="card" data-panel="settings" style="display:none">
        <h2>Settings</h2>
        <p class="muted">Profile visibility, notifications, and data export will live here.</p>
      </div>
    </section>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAoidTIHZZwOJ_FrXXMZd_hPAuoxDJJncs",
      authDomain: "deal-bankers.firebaseapp.com",
      databaseURL: "https://deal-bankers-default-rtdb.firebaseio.com",
      projectId: "deal-bankers",
      storageBucket: "deal-bankers.firebasestorage.app",
      messagingSenderId: "485110155601",
      appId: "1:485110155601:web:b4c38350ac58c1a2ecab70",
      measurementId: "G-KTNXZM14F7"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Optional: hardcode a default FEED here (or leave blank to rely on query/localStorage)
    const DEFAULT_FEED = ""; // e.g. "https://drive.google.com/uc?export=download&id=XXXX"

    // Persist a feed across sessions if user opens the portal in a new tab
    const urlFeed = new URL(location.href).searchParams.get('feed') || "";
    if (urlFeed) localStorage.setItem('acq_feed_url', urlFeed);

    // Redirect if not signed in + set UID/feed into iframes
    auth.onAuthStateChanged(user=>{
      if(!user){ location.href = 'index.html'; return; }
      const uid = encodeURIComponent(user.uid);
      const feed = encodeURIComponent(urlFeed || localStorage.getItem('acq_feed_url') || DEFAULT_FEED || "");

      const wh = document.getElementById('whFrame');
      const di = document.getElementById('diFrame');

      wh.src = `wholesaler.html?uid=${uid}${feed ? `&feed=${feed}` : ""}`;
      di.src = `dispo.html?uid=${uid}`;

      // Fullscreen buttons use same params
      document.getElementById('btnNewTabWh').addEventListener('click', ()=> {
        window.open(`wholesaler.html?uid=${uid}${feed ? `&feed=${feed}` : ""}`,'_blank');
      });
      document.getElementById('btnNewTabDi').addEventListener('click', ()=> {
        window.open(`dispo.html?uid=${uid}`,'_blank');
      });
    });

    // Top-level tabs
    const panels = [...document.querySelectorAll('[data-panel]')];
    const tabs   = [...document.querySelectorAll('.tab')];
    function show(tabName){
      tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
      panels.forEach(p => p.style.display = (p.dataset.panel === tabName) ? '' : 'none');
      const url = new URL(location.href);
      url.searchParams.set('tab', tabName);
      history.replaceState(null, '', url.toString());
    }
    document.getElementById('tabs').addEventListener('click', (e)=>{
      const btn = e.target.closest('.tab'); if(!btn) return;
      show(btn.dataset.tab);
    });
    show(new URL(location.href).searchParams.get('tab') || 'overview');

    // Wholesaler subtabs
    const whSubtabs = [...document.querySelectorAll('#whSubtabs .subtab')];
    const whSubPanels = [...document.querySelectorAll('[data-subpanel]')];
    function showWh(sub){
      whSubtabs.forEach(s => s.classList.toggle('active', s.dataset.sub === sub));
      whSubPanels.forEach(p => p.style.display = (p.dataset.subpanel === sub) ? '' : 'none');
      const url = new URL(location.href);
      url.searchParams.set('wh', sub);
      history.replaceState(null, '', url.toString());
    }
    document.getElementById('whSubtabs').addEventListener('click', (e)=>{
      const b = e.target.closest('.subtab'); if(!b) return;
      showWh(b.dataset.sub);
    });
    showWh(new URL(location.href).searchParams.get('wh') || 'acq');

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async ()=>{
      try{ await auth.signOut(); location.href = 'index.html'; }catch(err){ alert(err.message); }
    });

    // Frame reloads
    const whFrame = document.getElementById('whFrame');
    const diFrame = document.getElementById('diFrame');
    document.getElementById('btnReloadWh').addEventListener('click', ()=> whFrame.contentWindow?.location?.reload?.());
    document.getElementById('btnReloadDi').addEventListener('click', ()=> diFrame.contentWindow?.location?.reload?.());

    // Dispo placeholders
    document.getElementById('btnAddDeal').addEventListener('click', ()=> alert('Open "Add Deal" form (placeholder).'));
    document.getElementById('btnSharePacket').addEventListener('click', ()=> alert('Generate/share Investor Packet link (placeholder).'));
    document.getElementById('btnInvestorRoom').addEventListener('click', ()=> window.open('investor_room.html','_blank'));
  </script>
</body>
</html>
