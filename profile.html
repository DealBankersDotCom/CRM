<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DealBankers • Profile</title>
  <link rel="icon" href="images/db-icon-512.png"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#0f1720; --panel:#101a25; --muted:#8aa1ba; --text:#eaf2ff;
      --chip:#162232; --chip2:#1b2a3a; --border:rgba(255,255,255,.07);
      --green:#22c66a; --gold:#f3c969; --blue:#40a7ff; --red:#ff5a67;
      --br:16px; --br2:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#0b121a;color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 18px; background:rgba(10,16,23,.9); backdrop-filter: blur(6px);
      border-bottom:1px solid var(--border)
    }
    .brand{display:flex;align-items:center;gap:10px}
    .seal{width:34px;height:34px;border-radius:9px;background:#0b121a url('images/db-seal-256.png') center/cover; border:1px solid var(--border)}
    .title{font-weight:800;letter-spacing:.1em;color:#cfe3ff;font-size:12px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      background:var(--chip); border:1px solid var(--border); border-radius:999px;
      padding:8px 12px; font-weight:800; letter-spacing:.02em; cursor:pointer; color:#cfe3ff;
      text-decoration:none; display:inline-flex; align-items:center; gap:8px;
    }
    .chip.gold{background:#2a2414; color:#ffe9b0}
    .chip.red{background:#2a1a1a; color:#ffd7d9}
    .chip.blue{background:#18263a; color:#cfe9ff}
    .chip:hover{filter:brightness(1.05)}
    main{max-width:1100px;margin:22px auto;padding:0 16px}
    .tabs{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
    .tab{background:var(--chip2);border:1px solid var(--border);border-radius:999px;padding:8px 14px;font-weight:700;cursor:pointer}
    .tab.active{background:#1f2e42}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--br);padding:16px}
    .row{display:flex;gap:12px;align-items:center}
    .row input, textarea{
      width:100%;background:#0e1620;border:1px solid var(--border);color:var(--text);
      border-radius:10px;padding:10px 12px
    }
    .btn{background:linear-gradient(180deg,var(--green),#18a155); border:none; color:#062511; padding:10px 14px; border-radius:10px; font-weight:800; cursor:pointer}
    .btn:hover{filter:brightness(1.05)}
    .note{color:var(--muted);font-size:12px}
    .list{display:flex;flex-direction:column;gap:8px;max-height:260px;overflow:auto}
    .msg{background:#0d1620;border:1px solid var(--border);border-radius:10px;padding:8px 10px}
    .link{color:#9dd3ff;text-decoration:none}
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="seal"></div>
    <div class="title">DEALBANKERS • PROFILE</div>
  </div>
  <div class="chips">
    <a class="chip gold" href="claims-exchange.html">Claims Exchange</a>
    <a class="chip red"  href="support.html#sales">Sales</a>
    <a class="chip blue" href="support.html">Support</a>
    <button class="chip" id="logoutBtn">Log Out</button>
  </div>
</header>

<main>
  <div class="tabs">
    <button class="tab active" data-tab="overview">Overview</button>
    <button class="tab" data-tab="wholesaler">Wholesaler</button>
    <button class="tab" data-tab="contractor">Contractor</button>
    <button class="tab" data-tab="realtor">Realtor</button>
    <button class="tab" data-tab="settings">Settings</button>
  </div>

  <!-- Overview -->
  <section class="panel" data-panel="overview">
    <div style="margin-bottom:12px;font-weight:700">Capital Open: <span style="color:#9bffc5">$300k</span> • Turn: <span style="color:#ffd788">7–10 days</span></div>
    <div style="margin-bottom:8px;font-weight:700">Townhall (All Users)</div>
    <div class="list" id="chatList"></div>
    <div class="row" style="margin-top:8px">
      <input id="chatInput" placeholder="Say something to the room… (press Enter to send)"/>
      <button class="btn" id="chatSend">Send</button>
    </div>
  </section>

  <!-- Wholesaler -->
  <section class="panel" data-panel="wholesaler" hidden>
    Lead filters live in <strong>Settings → Wholesaler</strong>.
    <div style="margin-top:10px">
      <a class="link" href="wholesaler.html">Go to Wholesaler portal</a>.
    </div>
  </section>

  <!-- Contractor -->
  <section class="panel" data-panel="contractor" hidden>
    Post jobs and manage crews in the <a class="link" href="contractor.html">Contractor portal</a>.
  </section>

  <!-- Realtor -->
  <section class="panel" data-panel="realtor" hidden>
    Realtor tools are available here: <a class="link" href="realtor.html">Realtor portal</a>.
  </section>

  <!-- Settings -->
  <section class="panel" data-panel="settings" hidden>
    <div style="font-weight:700;margin-bottom:8px">Settings</div>
    <div class="note">User role management & branding here.</div>
    <div id="adminBox" style="margin-top:14px;display:none">
      <hr style="border:none;border-top:1px solid var(--border);margin:12px 0">
      <div style="font-weight:800;margin-bottom:8px">God Mode (Admin)</div>
      <div class="row" style="margin-bottom:8px">
        <input id="peekUid" placeholder="Paste target UID to peek…"/>
        <button class="btn" id="peekBtn">Load</button>
      </div>
      <div class="list" id="peekOut"></div>
    </div>
  </section>
</main>

<script type="module" src="./app-auth.js"></script>
<script type="module">
import { DB } from './app-auth.js';

await DB.requireAuth('index.html'); // force login
document.getElementById('logoutBtn').addEventListener('click', DB.signOut);

// Tabs
const tabs = [...document.querySelectorAll('.tab')];
const panels = [...document.querySelectorAll('[data-panel]')];
tabs.forEach(t=>{
  t.addEventListener('click', ()=>{
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const k=t.dataset.tab;
    panels.forEach(p=>p.hidden = p.dataset.panel!==k);
  });
});

// Townhall
DB.bindTownhall({
  list: document.getElementById('chatList'),
  input: document.getElementById('chatInput'),
  sendBtn: document.getElementById('chatSend')
});

// Admin (God Mode)
const me = (await DB.requireAuth()).uid;
if (await DB.isAdmin(me)) {
  document.getElementById('adminBox').style.display='block';
  const out = document.getElementById('peekOut');
  document.getElementById('peekBtn').addEventListener('click', async ()=>{
    const uid = (document.getElementById('peekUid').value||'').trim();
    out.innerHTML = '';
    if(!uid){ out.textContent = 'Enter a UID.'; return; }
    const role = await DB.getRole(uid);
    const div = document.createElement('div');
    div.className = 'msg';
    div.textContent = `UID: ${uid} • Role: ${role || '(none)'}`;
    out.appendChild(div);
  });
}
</script>
</body>
</html>
