<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DealBankers • Profile</title>
  <link rel="icon" type="image/jpeg" href="icon (1).jpg"/>
  <style>
    :root{--bg:#0e1822;--panel:#0f1a24;--line:#1c2c3a;--text:#eaf1f6;--muted:#97b0c5;--gold:#c7a86a;--accent:#5de0ff;--r:16px}
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(135deg,#0b1218,#102131);color:var(--text);font-family:system-ui,Segoe UI,Inter,Arial}
    .shell{max-width:1200px;margin:0 auto;padding:12px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px;border:1px solid var(--line);border-radius:20px;background:#0f1a24}
    .brand{display:flex;gap:10px;align-items:center}
    .brand img{width:40px;height:40px;border-radius:10px}
    .title{letter-spacing:.16em;color:#cfe1f3}
    .tabs{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap}
    .tab{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#0e1a28;color:#cfe1f3;cursor:pointer}
    .tab.active{background:linear-gradient(180deg,var(--gold),#9d7d49);color:#111;border:none}
    .card{border:1px solid var(--line);background:#0f1a24;border-radius:var(--r);padding:12px}
    .muted{color:var(--muted)}
    .iframe{width:100%;height:86vh;min-height:620px;border:0;border-radius:14px;background:#0b141b}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#0f2230;color:#eaf1f6;cursor:pointer}
    .btn.gold{background:linear-gradient(180deg,var(--gold),#9d7d49);color:#111;border:none}
    .field{display:grid;gap:6px;margin:8px 0}
    .input,.select{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0c1620;color:#eaf1f6;width:100%}
    @media(max-width:820px){.iframe{height:90vh;min-height:680px}}
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand">
        <img src="icon (1).jpg" alt="DealBankers"/>
        <div class="title">DEALBANKERS • PROFILE</div>
      </div>
      <div class="row">
        <button id="requestsBtn" class="btn gold">Requests</button>
        <button id="logoutBtn" class="btn">Log Out</button>
      </div>
    </header>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-tab="wholesaler">Wholesaler</button>
      <button class="tab" data-tab="settings">Settings</button>
    </nav>

    <!-- WHOLESALER -->
    <section class="card" data-panel="wholesaler">
      <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:6px">
        <div class="muted">Acquisition tools, mobile-first.</div>
        <button id="openFs" class="btn">Open Fullscreen</button>
      </div>
      <iframe id="whFrame" class="iframe" src="about:blank" title="Wholesaler"></iframe>
    </section>

    <!-- SETTINGS -->
    <section class="card" data-panel="settings" style="display:none">
      <h3 style="margin:6px 0 10px">Wholesaler Portal Settings</h3>
      <div class="muted" style="margin-bottom:8px">Choose how the **Call** button should dial numbers.</div>

      <div class="field">
        <label class="muted">Dial Provider</label>
        <select id="dialProvider" class="select">
          <option value="system">System Dialer (tel:)</option>
          <option value="textnow">TextNow (open messaging; number copied)</option>
          <option value="gvoice">Google Voice (open Calls; number copied)</option>
          <option value="custom">Custom URL Template</option>
        </select>
      </div>

      <div class="field" id="customWrap" style="display:none">
        <label class="muted">Custom URL Template (use <code>{number}</code>)</label>
        <input id="customTemplate" class="input" placeholder="e.g. myapp://dial/{number}"/>
      </div>

      <div class="row">
        <button id="saveSettings" class="btn gold">Save</button>
        <div id="saveMsg" class="muted" style="align-self:center"></div>
      </div>
    </section>
  </div>

  <!-- Minimal Requests modal hook (opens parent modal in future) -->
  <script>
    document.getElementById('requestsBtn').onclick=()=>alert('Requests modal coming next (submits to Firebase).');
  </script>

  <!-- Firebase (modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const app = initializeApp({
      apiKey: "AIzaSyAoidTIHZZwOJ_FrXXMZd_hPAuoxDJJncs",
      authDomain: "deal-bankers.firebaseapp.com",
      databaseURL: "https://deal-bankers-default-rtdb.firebaseio.com",
      projectId: "deal-bankers"
    });
    const auth = getAuth(app);
    const db   = getDatabase(app);

    const $ = s=>document.querySelector(s);
    const tabs=[...document.querySelectorAll('.tab')];
    const panels=[...document.querySelectorAll('[data-panel]')];
    function show(tab){ tabs.forEach(t=>t.classList.toggle('active',t.dataset.tab===tab)); panels.forEach(p=>p.style.display=(p.dataset.panel===tab)?'':'none'); history.replaceState(null,'',`?tab=${tab}`); }
    $('#tabs').addEventListener('click',e=>{const b=e.target.closest('.tab'); if(!b) return; show(b.dataset.tab);});
    show(new URL(location.href).searchParams.get('tab')||'wholesaler');

    let currentUser=null;
    onAuthStateChanged(auth, async (user)=>{
      if(!user){ location.href='index.html'; return; }
      currentUser=user;

      // load wholesaler iframe
      const uid=encodeURIComponent(user.uid);
      document.getElementById('whFrame').src=`wholesaler.html?uid=${uid}`;

      // load settings
      const sref = ref(db, `users/${user.uid}/wholesaler/settings`);
      const snap = await get(sref);
      const data = snap.exists()? snap.val(): { dialProvider:'system', customTemplate:'' };
      $('#dialProvider').value = data.dialProvider || 'system';
      $('#customTemplate').value = data.customTemplate || '';
      $('#customWrap').style.display = (data.dialProvider==='custom')?'block':'none';
    });

    // save settings
    $('#dialProvider').addEventListener('change', e=>{
      $('#customWrap').style.display = (e.target.value==='custom')?'block':'none';
    });
    $('#saveSettings').onclick = async ()=>{
      if(!currentUser) return;
      const dialProvider = $('#dialProvider').value;
      const customTemplate = $('#customTemplate').value.trim();
      await set(ref(db, `users/${currentUser.uid}/wholesaler/settings`), { dialProvider, customTemplate });
      $('#saveMsg').textContent='Saved ✓';
      setTimeout(()=>$('#saveMsg').textContent='',1500);
      // ping iframe so it can refresh its dial config
      document.getElementById('whFrame').contentWindow.postMessage({type:'refreshDial'}, '*');
    };

    // fullscreen helper
    document.getElementById('openFs').onclick=()=>{
      window.open(document.getElementById('whFrame').src, '_blank', 'noopener');
    };

    // logout
    document.getElementById('logoutBtn').onclick=async()=>{ await signOut(auth); location.href='index.html'; };
  </script>
</body>
</html>
