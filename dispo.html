<!-- ========================= dispo.html ========================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Deal Bankers ‚Ä¢ Dispo CRM</title>
  <link rel="icon" type="image/jpeg" href="icon (1).jpg"/>
  <style>
    :root{--bg:#0c151e;--panel:#0f1a24;--line:#24455f;--text:#e9f3ff;--muted:#a9c3db;--btn:#173449;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;background:linear-gradient(135deg,#0b1118,#0e1a24 55%,#10283a);color:var(--text)}
    header{background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));border-bottom:1px solid var(--line);padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    .menu{cursor:pointer;font-size:22px}
    .menu-content{display:none;position:absolute;top:56px;right:12px;background:#0f1a24;border:1px solid var(--line);border-radius:10px;box-shadow:0 12px 32px rgba(0,0,0,.45);z-index:10}
    .menu-content a{display:block;padding:10px 14px;text-decoration:none;color:#cfe3f6}
    .menu-content a:hover{background:#0e2433}
    .container{display:flex;flex-direction:column;gap:12px;padding:12px}
    @media (min-width:780px){ .container{flex-direction:row;height:calc(100vh - 56px)} }
    .lead-section,.map-section{flex:1;min-width:0}
    .lead-buttons{display:flex;justify-content:center;gap:10px;margin-bottom:10px;flex-wrap:wrap}
    .lead-buttons a,.lead-buttons button{font-size:22px;border:1px solid var(--line);border-radius:10px;text-decoration:none;cursor:pointer;padding:8px 12px;color:#fff;background:#0e2433}
    .lead-buttons .call,.lead-buttons .text{background:linear-gradient(180deg,#ffd36b,#c89b3a);color:#211a05;border:none}
    .lead-buttons .dirs{background:#0e2433}
    .lead-card{background:#10222e;border:1px solid var(--line);border-radius:12px;padding:14px;box-shadow:0 14px 36px rgba(0,0,0,.35);margin:0 auto 12px;max-width:560px}
    .lead-card a{color:#8cc8ff;text-decoration:none}
    .lead-card a:hover{text-decoration:underline}
    .lead-card button{background:linear-gradient(180deg,#26cf84,#1a9b61);color:#fff;padding:8px 12px;border:none;border-radius:8px;font-size:14px;margin-top:10px;cursor:pointer}
    .next-btn{display:block;margin:12px auto;padding:10px 20px;font-size:18px;background:linear-gradient(180deg,#2b74ff,#0a58ca);color:#fff;border:none;border-radius:10px;cursor:pointer}
    iframe.map{width:100%;height:320px;border:none;border-radius:12px;background:#fff}
    @media (min-width:780px){ iframe.map{height:100%} }
    .modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,.7);justify-content:center;align-items:center}
    .modal-content{width:92%;height:80%;background:#0f1a24;border-radius:12px;overflow:hidden;position:relative;border:1px solid var(--line)}
    .modal iframe{width:100%;height:100%;border:none}
    .close-btn{position:absolute;top:10px;right:15px;font-size:20px;background:#333;color:white;border:none;border-radius:50%;width:34px;height:34px;cursor:pointer}
    .accordion{margin-top:10px;border-radius:8px;overflow:hidden;border:1px solid var(--line)}
    .accordion summary{background:#0f2a3a;cursor:pointer;padding:10px;font-weight:700;color:#cfe3f6}
    .accordion div{padding:10px;background:#0e2433;font-size:14px;color:#cfe3f6}
  </style>

  <script src="dispo.js"></script>
  <script>
    let index = 0;

    function gmapDir(addr){ return `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(addr)}`; }

    function showLead(lead) {
      const name = lead.contacts?.[0]?.name || "Unknown";
      const phone = lead.contacts?.[0]?.phone || "N/A";
      const notes = lead.notes ? lead.notes.replace(/\n/g, "<br>") : "No deal notes available.";
      const url = `https://docs.google.com/forms/d/e/1FAIpQLScIZ7GX_ga5yOx34817gOL8Bb5m3KFXW8r-5I4taw_-ergOxw/viewform?usp=pp_url&entry.849181096=Dispo&entry.121126280=${encodeURIComponent(name)}&entry.1828741519=${encodeURIComponent(lead.address)}`;

      const dirs = gmapDir(lead.address||'');

      document.getElementById("leadCard").innerHTML = `
        <div class="lead-buttons">
          <button class="call" onclick="copyToClipboard('${phone}')">üìû</button>
          <a class="text" href="https://www.textnow.com/messaging" target="_blank">üí¨</a>
          <a class="dirs" href="${dirs}" target="_blank" title="Directions">üöó</a>
          <a class="dirs" href="https://drive.google.com" target="_blank" title="Drive">üìÅ</a>
        </div>
        <div class="lead-card">
          <strong>${name}</strong><br/>
          ${lead.address || ''}<br/>
          <a href="https://www.textnow.com/messaging" target="_blank">Open TextNow</a><br/>
          <button onclick="openModal('${url}')">üìù Update Notes</button>
          <details class="accordion">
            <summary>üìä Deal Details</summary>
            <div>${notes}</div>
          </details>
        </div>
      `;
    }

    function nextLead() {
      index = (index + 1) % (leads?.length || 1);
      showLead(leads[index]);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => alert("Copied number: " + text));
    }

    function openModal(url) {
      const modal = document.getElementById("formModal");
      const iframe = document.getElementById("formIframe");
      iframe.src = url;
      modal.style.display = "flex";
    }

    function closeModal() {
      document.getElementById("formModal").style.display = "none";
      document.getElementById("formIframe").src = "";
    }

    function toggleMenu() {
      const menu = document.getElementById("menuContent");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    window.onload = function () {
      if (Array.isArray(leads) && leads.length > 0) {
        index = 0;
        showLead(leads[index]);
      } else {
        document.getElementById("leadCard").innerHTML = `<div class="lead-card">No dispo deals loaded.</div>`;
      }
    };
  </script>
</head>
<body>
  <header>
    <div>Deal Bankers ‚Ä¢ Dispo CRM</div>
    <div style="position:relative">
      <div class="menu" onclick="toggleMenu()">‚ò∞</div>
      <div class="menu-content" id="menuContent">
        <a href="wholesaler.html">Go to Acquisition</a>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="lead-section">
      <div id="leadCard"></div>
      <button class="next-btn" onclick="nextLead()">‚è≠Ô∏è Next Deal</button>
    </div>
    <div class="map-section">
      <iframe class="map"
        src="https://www.google.com/maps/d/u/0/embed?mid=1C_OfzvCIlHnx-6nLaZ3Y88izZtflM5g&ehbc=2E312F"
        allowfullscreen></iframe>
    </div>
  </div>

  <div id="formModal" class="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">√ó</button>
      <iframe id="formIframe"></iframe>
    </div>
  </div>
</body>
</html>
