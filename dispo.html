<!-- ============================ dispo.html (Disposition Portal ‚Ä¢ Offerings manager ‚Ä¢ Share tools) ============================ -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Deal Bankers ‚Ä¢ Dispo</title>
  <link rel="icon" type="image/jpeg" href="icon (1).jpg"/>

  <style>
    :root{
      --bg1:#0b131b; --bg2:#142838; --bg3:#173c53;
      --line:#2a5a78; --text:#f3f8fb; --muted:#c7d7e6;
      --gold:#ffd36b; --green:#26cf84; --blue:#47b4ff; --panel:#133045;
      --r:16px; --shadow:0 28px 70px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 520px at 92% -12%, rgba(93,224,255,.22) 0%, transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2) 55%,var(--bg3));
      padding:10px;
    }
    .wrap{max-width:1200px;margin:0 auto}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.18); border-radius:20px; box-shadow:var(--shadow); overflow:hidden}

    /* Header */
    .top{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.2);
      background:linear-gradient(180deg,rgba(255,255,255,.18),rgba(255,255,255,.06)); font-size:14px}
    .crumbs{display:flex;gap:10px;align-items:center;color:var(--muted)}
    .dot{width:7px;height:7px;border-radius:999px;background:var(--blue);box-shadow:0 0 14px rgba(93,224,255,.9)}
    .status{font-size:12px;color:#e8f7ff}

    /* Toolbar */
    .sticky{position:sticky;top:0;z-index:8;padding:10px;border-bottom:1px solid rgba(255,255,255,.2);
      background:linear-gradient(180deg,rgba(0,0,0,.15),rgba(255,255,255,.06))}
    .actions{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:10px;border-radius:12px;
      font-weight:800;border:1px solid rgba(255,255,255,.22);background:#0e2433;color:#eaf6ff;cursor:pointer;min-height:44px;text-decoration:none
    }
    .btn:hover{filter:brightness(1.08)}
    .btn-gold{background:linear-gradient(180deg,var(--gold),#c89b3a);color:#211a05;border:none}
    .btn-green{background:linear-gradient(180deg,var(--green),#1a9b61);color:#fff;border:none}
    .btn-ghost{background:#0f2a3a}
    .ico{font-size:18px}
    .label{display:inline}
    @media (max-width:680px){ .label{display:none} }

    .navrow{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}

    /* Grid: left = offerings & share, right = preview */
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px;padding:12px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }

    .panel{border:1px solid rgba(255,255,255,.18); border-radius:16px; padding:12px; background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03))}
    .h{margin:0 0 8px; font-size:16px; letter-spacing:.04em}

    /* Offer item */
    .offer{display:flex;align-items:center;gap:10px;justify-content:space-between;border:1px solid rgba(255,255,255,.18);
      background:#0f2233;border-radius:12px;padding:10px}
    .badge{font-size:11px;padding:4px 8px;border:1px solid rgba(255,255,255,.18);border-radius:999px;background:#0c1f2d;color:#cfe7ff}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .pdf{width:100%;height:560px;border:0;border-radius:12px;background:#fff}
    @media (max-width:980px){ .pdf{height:420px} }

    .off-row{display:grid;grid-template-columns:1fr 2fr auto;gap:8px}
    @media (max-width:640px){ .off-row{grid-template-columns:1fr} }

    .input, .textarea{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.2);
      background:#0d2130;color:#eaf6ff;font-size:14px
    }
    .textarea{min-height:120px;resize:vertical}

    /* Lead card */
    .lead-wrap{padding:12px}
    .lead{border:1px solid rgba(255,255,255,.22);border-radius:16px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03))}
    .title{padding:12px 14px;font-weight:900;letter-spacing:.02em;font-size:18px;border-bottom:1px solid rgba(255,255,255,.18);
      background:linear-gradient(90deg,rgba(255,211,107,.22),transparent 45%),linear-gradient(180deg,rgba(0,0,0,.15),transparent)}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .chip{font-size:12px;font-weight:700;padding:7px 11px;border-radius:999px;border:1px solid rgba(255,255,255,.22);background:#0f2c3e}
    .map{width:100%;height:260px;border:0;border-radius:14px;background:#fff;margin-top:8px}

    /* Toast */
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#0b1218;
      color:#fff;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.2);box-shadow:var(--shadow);font-size:14px;display:none;z-index:70}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <div class="top">
        <div class="crumbs"><span>Wholesaler</span><span class="dot"></span><span>Dispo</span></div>
        <div class="status" id="status">Loading‚Ä¶</div>
      </div>

      <div class="sticky">
        <div class="actions" id="toolbar">
          <a class="btn btn-gold" href="#" id="actCall"  title="Call"><span class="ico">üìû</span><span class="label">Call</span></a>
          <a class="btn btn-gold" href="#" id="actSMS"   title="Text"><span class="ico">üí¨</span><span class="label">Text</span></a>
          <button class="btn btn-ghost" id="actCopy"     title="Copy number"><span class="ico">üìã</span><span class="label">Copy #</span></button>
          <button class="btn btn-ghost" id="btnOfferings" title="Offerings"><span class="ico">üìÑ</span><span class="label">Offerings</span></button>
          <button class="btn btn-ghost" id="btnShare"     title="Share / Blast"><span class="ico">üì£</span><span class="label">Share</span></button>
          <button class="btn btn-ghost" id="actSettings" title="Settings"><span class="ico">‚öôÔ∏è</span><span class="label">Settings</span></button>
        </div>
        <div class="navrow">
          <button class="btn btn-ghost" id="btnPrev"   title="Prev">‚óÄ <span class="label">Prev</span></button>
          <button class="btn btn-ghost" id="btnRandom" title="Random">üé≤ <span class="label">Random</span></button>
          <button class="btn btn-green" id="btnNext"   title="Next"><span class="label">Next</span> ‚ñ∂</button>
        </div>
      </div>

      <!-- Offerings + Preview -->
      <div class="grid">
        <div class="panel">
          <h3 class="h">Active Offerings</h3>

          <!-- Virgin D6 (memo2 first) -->
          <div class="offer">
            <div>
              <div class="row" style="font-weight:800">Virgin D6 Lift ‚Äî FOB Houston</div>
              <div class="row" style="margin-top:6px">
                <span class="badge">Capital Need: $300k</span>
                <span class="badge">Repay: 7‚Äì10 days</span>
                <span class="badge">100M gallons</span>
              </div>
            </div>
            <div class="row">
              <a class="btn" target="_blank" rel="noopener" id="btnOpenMemo2">Open Offering Memo</a>
              <a class="btn" target="_blank" rel="noopener" id="btnInterest">Submit Interest</a>
            </div>
          </div>

          <!-- Slot for your new page -->
          <div class="offer" style="margin-top:10px">
            <div>
              <div class="row" style="font-weight:800">Booth St. Case Study</div>
              <div class="row" style="margin-top:6px">
                <span class="badge">offering-memo2.html</span>
              </div>
            </div>
            <div class="row">
              <a class="btn" target="_blank" rel="noopener" href="offering-memo2.html">Open Memo 2</a>
              <a class="btn btn-ghost" target="_blank" rel="noopener" href="offering-memo.html">Open Memo 1</a>
            </div>
          </div>

          <div class="panel" style="margin-top:12px">
            <div class="row" style="gap:12px;align-items:center">
              <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4c4.svg" alt="" style="width:18px;height:18px;opacity:.9"/>
              <div style="font-weight:800">Add your first Dispo offering</div>
            </div>
            <div class="off-row" style="margin-top:10px">
              <input id="offTitle" class="input" placeholder="Title (e.g., Virgin D6 Lift)"/>
              <input id="offUrl" class="input" placeholder="PDF URL (public)"/>
              <button id="offAdd" class="btn">Create Offering</button>
            </div>
            <div id="offsList" class="off-list" style="margin-top:10px"></div>
          </div>
        </div>

        <div class="panel">
          <h3 class="h">Statement of Facts (Inline Preview)</h3>
          <iframe id="sofFrame" class="pdf" title="SOF preview"></iframe>
        </div>
      </div>

      <!-- Lead viewer -->
      <div class="lead-wrap">
        <div id="leadCard" class="lead">
          <div class="title">Your Dispo Lead</div>
          <div class="chips" id="chips"></div>
          <textarea id="noteInput" class="textarea" placeholder="Dispo notes‚Ä¶"></textarea>
          <div class="row" style="margin-top:8px">
            <button id="inlineSave" class="btn btn-gold"><span class="ico">üíæ</span> <span class="label">Save Notes</span></button>
          </div>
          <iframe class="map" id="map" loading="lazy" referrerpolicy="no-referrer-when-downgrade" title="Map"></iframe>
        </div>
      </div>

      <!-- Share tools -->
      <div class="grid" style="padding-top:0">
        <div class="panel">
          <h3 class="h">Share / Blast (manual, ToS-friendly)</h3>
          <textarea id="adText" class="textarea" placeholder="Ad copy will appear here‚Ä¶"></textarea>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="copyAd">Copy for Craigslist</button>
            <a class="btn" id="openCL" target="_blank" rel="noopener" href="https://www.craigslist.org">Open Craigslist</a>
            <a class="btn" id="openFB" target="_blank" rel="noopener" href="https://www.facebook.com/marketplace/create">Open FB Marketplace</a>
          </div>
          <div class="row" style="margin-top:8px">
            <a class="btn" id="mailtoBtn">Email Buyers</a>
            <a class="btn" id="smsBtn">Mass SMS (paste list)</a>
          </div>
          <div class="row" style="margin-top:8px;color:#9fb3c7;font-size:12px">
            Tip: We generate content and open the proper pages. You review/submit to stay compliant with site policies.
          </div>
        </div>
        <div class="panel">
          <h3 class="h">Current Offer Link</h3>
          <div class="row">
            <input id="offerLink" class="input" readonly/>
            <button class="btn" id="copyLink">Copy Link</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="toast"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

  <script>
    // ---------------- Firebase ----------------
    const firebaseConfig = {
      apiKey:"AIzaSyAoidTIHZZwOJ_FrXXMZd_hPAuoxDJJncs",
      authDomain:"deal-bankers.firebaseapp.com",
      databaseURL:"https://deal-bankers-default-rtdb.firebaseio.com",
      projectId:"deal-bankers"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // ---------------- Helpers ----------------
    const $ = s => document.querySelector(s);
    const statusEl = $('#status');
    const toastEl = $('#toast');
    function toast(t){ toastEl.textContent=t; toastEl.style.display='block'; setTimeout(()=>toastEl.style.display='none',1600); }
    function setStatus(t){ statusEl.textContent = t; }
    const clean = s => (s||'').trim();
    const BILL_PHONE = "2104281449";

    // Dial mode
    const MODE_KEY='db_phone_link_mode_dispo';
    const getMode=()=>localStorage.getItem(MODE_KEY)||'device';
    const setMode=m=>localStorage.setItem(MODE_KEY,m);
    function phoneHref(number, mode){
      const num=(number||'').replace(/[^\d+]/g,'');
      if(!num) return '#';
      if(mode==='device') return `tel:${num}`;
      if(mode==='textnow'){ navigator.clipboard?.writeText(num); return 'https://www.textnow.com/messaging'; }
      if(mode==='gvoice'){ navigator.clipboard?.writeText(num); return 'https://voice.google.com/u/0/messages'; }
      return `tel:${num}`;
    }

    // ---------- Offering: SOF and memo links ----------
    const DRIVE_SOF_PREVIEW = "https://drive.google.com/file/d/1GybST-_K4XW3Q3H6QNd6cdPGw8J5XVtT/preview";

    // Wire default (memo2 first)
    $('#btnOpenMemo2').href = `offering-memo2.html?sof=${encodeURIComponent(DRIVE_SOF_PREVIEW)}`;
    $('#btnInterest').href  = `offering-memo2.html?sof=${encodeURIComponent(DRIVE_SOF_PREVIEW)}#interest`;
    $('#sofFrame').src = DRIVE_SOF_PREVIEW;
    $('#offerLink').value = location.origin + '/offering-memo2.html?sof=' + encodeURIComponent(DRIVE_SOF_PREVIEW);

    // ---------- Share helpers ----------
    function buildAdCopy(){
      return [
        "üî• Virgin D6 Lift ‚Äî FOB Houston",
        "‚Ä¢ Capital need: $300,000  ‚Ä¢ Repay: 7‚Äì10 banking days",
        "‚Ä¢ First lift: 100,000,000 gallons",
        "‚Ä¢ Exit buyer in place (pay on injection & clearance)",
        "",
        "Docs on file: SPA, TSR invoice, SOF, Voided check",
        "",
        "Offering memo & SOF:",
        location.origin + '/offering-memo2.html?sof=' + encodeURIComponent(DRIVE_SOF_PREVIEW),
        "",
        "Text Bill: " + BILL_PHONE
      ].join("\n");
    }
    function smsHref(body){
      const base = /iPhone|iPad|Macintosh/.test(navigator.userAgent) ? `sms:${BILL_PHONE}&` : `sms:${BILL_PHONE}?`;
      return base + "body=" + encodeURIComponent(body);
    }
    $('#adText').value = buildAdCopy();
    $('#copyAd').onclick = ()=>{ navigator.clipboard.writeText($('#adText').value).then(()=>toast('Ad copied')); };
    $('#mailtoBtn').href = `mailto:?subject=${encodeURIComponent('Virgin D6 Lift ‚Äî Investor Interest')}&body=${encodeURIComponent($('#adText').value)}`;
    $('#smsBtn').href    = smsHref('Interested in D6 Capital Raise');
    $('#copyLink').onclick = ()=>{ navigator.clipboard.writeText($('#offerLink').value).then(()=>toast('Link copied')); };

    // ---------- Offerings (per-user) ----------
    async function loadOfferings(){
      const uid = auth.currentUser?.uid || 'anon';
      const snap = await db.ref(`offerings/${uid}`).get();
      const list = snap.val() || {};
      const wrap = $('#offsList');
      wrap.innerHTML = '';
      const entries = Object.entries(list).sort((a,b)=> (b[1]?.ts||0)-(a[1]?.ts||0));
      if(!entries.length){
        const p=document.createElement('p'); p.style.color='#c7d7e6'; p.textContent='No offerings yet. Add one above.';
        wrap.appendChild(p);
      } else {
        entries.forEach(([id,o])=>{
          const url = o.pdfUrl || '';
          const row = document.createElement('div');
          row.className = 'offer';
          row.innerHTML = `
            <div style="font-weight:800">${o.title||'Untitled'}</div>
            <div class="row">
              <a class="btn" target="_blank" rel="noopener" href="offering-memo2.html?sof=${encodeURIComponent(url)}">Open (Memo 2)</a>
              <a class="btn btn-ghost" target="_blank" rel="noopener" href="offering-memo.html?sof=${encodeURIComponent(url)}">Open (Memo 1)</a>
              <button class="btn btn-ghost" data-del="${id}">Delete</button>
            </div>`;
          wrap.appendChild(row);
        });
        wrap.querySelectorAll('[data-del]').forEach(btn=>{
          btn.onclick = async()=>{ if(confirm('Delete this offering?')){ 
            await db.ref(`offerings/${auth.currentUser?.uid||'anon'}/${btn.dataset.del}`).remove(); 
            loadOfferings(); 
          }};
        });
      }
    }
    $('#btnOfferings').onclick = ()=>loadOfferings();
    $('#offAdd').onclick = async ()=>{
      const title = $('#offTitle').value.trim();
      const pdfUrl = $('#offUrl').value.trim();
      if(!title || !pdfUrl){ return alert('Title and PDF URL are required'); }
      const uid = auth.currentUser?.uid || 'anon';
      await db.ref(`offerings/${uid}`).push({ title, pdfUrl, ts: Date.now() });
      $('#offTitle').value=''; $('#offUrl').value='';
      loadOfferings(); toast('Offering added');
    };

    // ---------- Dispo lead viewer (window.dispo or lazy dispo.js) ----------
    const chips = $('#chips');
    function mapSrc(addr){ return `https://www.google.com/maps?output=embed&q=${encodeURIComponent(addr||'San Antonio, TX')}`; }
    function useLead(lead){
      const addr  = clean(lead?.address || lead?.market || 'San Antonio, TX');
      const phone = clean(lead?.contacts?.[0]?.phone || '');
      const mode  = getMode();
      $('#actCall').href = phoneHref(phone, mode);
      $('#actSMS').href  = mode==='device' && phone ? `sms:${phone}` : phoneHref(phone, mode);
      chips.innerHTML = `
        <div class="chip">${addr}</div>
        <div class="chip">${phone ? 'Phone on file' : 'No phone'}</div>
        <div class="chip">Dial: ${mode}</div>`;
      $('#map').src = mapSrc(addr);
      $('#noteInput').value = localStorage.getItem('db_dispo_notes_'+addr) || (lead?.notes||'');
      $('#inlineSave').onclick = ()=>{ localStorage.setItem('db_dispo_notes_'+addr, $('#noteInput').value.trim()); toast('Notes saved'); };
    }
    function bootLead(){
      if(window.dispo && window.dispo.length){ useLead(window.dispo[0]); setStatus('Ready'); return; }
      const s=document.createElement('script');
      s.src='dispo.js?v='+Date.now();
      s.onload=()=>{ if(window.dispo?.length){ useLead(window.dispo[0]); } setStatus('Ready'); };
      s.onerror=()=>{ useLead({}); setStatus('Ready'); };
      document.head.appendChild(s);
    }

    // Copy number
    $('#actCopy').onclick = ()=>{
      const txt = $('#actCall').href || '';
      const num = txt.replace(/.*tel:/,'').replace(/[^\d+]/g,'');
      if(!num) return alert('No phone on this record.');
      navigator.clipboard.writeText(num).then(()=>toast('Phone copied'));
    };

    // Dial mode cycle
    $('#actSettings').onclick = ()=>{
      const cur=getMode();
      const next = cur==='device' ? 'textnow' : cur==='textnow' ? 'gvoice' : 'device';
      setMode(next);
      toast(`Dial mode: ${next}`);
    };

    // Share button scrolls to panel
    $('#btnShare').onclick = ()=>document.getElementById('adText').scrollIntoView({behavior:'smooth',block:'center'});

    auth.onAuthStateChanged(()=>{ bootLead(); loadOfferings(); });

    setStatus('Ready');
  </script>
</body>
</html>
